/*!
 * ====================================================
 * Formula Editor - v1.0.3 - 2020-08-10
 * https://github.com/SugarTurboS/Formula-Editor
 * GitHub: git@github.com:SugarTurboS/Formula-Editor.git 
 * Copyright (c) 2020 sugarteam; Licensed MIT
 * ====================================================
 */
!function(){function a(a){b.r([c[a]])}var b={r:function(a){if(b[a].inited)return b[a].value;if("function"!=typeof b[a].value)return b[a].inited=!0,b[a].value;var c={exports:{}},d=b[a].value(null,c.exports,c);if(b[a].inited=!0,b[a].value=d,void 0!==d)return d;for(var e in c.exports)if(c.exports.hasOwnProperty(e))return b[a].inited=!0,b[a].value=c.exports,c.exports}};b[0]={value:function(a){function b(a){this.ok=!1,"#"==a.charAt(0)&&(a=a.substr(1,6)),a=a.replace(/ /g,""),a=a.toLowerCase();var c={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var d in c)a==d&&(a=c[d]);for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}],f=0;f<e.length;f++){var g=e[f].re,h=e[f].process,i=g.exec(a);i&&(channels=h(i),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var a=this.r.toString(16),b=this.g.toString(16),c=this.b.toString(16);return 1==a.length&&(a="0"+a),1==b.length&&(b="0"+b),1==c.length&&(c="0"+c),"#"+a+b+c},this.getHelpXML=function(){for(var a=new Array,d=0;d<e.length;d++)for(var f=e[d].example,g=0;g<f.length;g++)a[a.length]=f[g];for(var h in c)a[a.length]=h;var i=document.createElement("ul");i.setAttribute("id","rgbcolor-examples");for(var d=0;d<a.length;d++)try{var j=document.createElement("li"),k=new b(a[d]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+k.toHex()+"; color:"+k.toHex(),l.appendChild(document.createTextNode("test"));var m=document.createTextNode(" "+a[d]+" -> "+k.toRGB()+" -> "+k.toHex());j.appendChild(l),j.appendChild(m),i.appendChild(j)}catch(n){}return i}}function c(a,b,c,g,h,i){if(!(isNaN(i)||1>i)){i|=0;var j,k=document.getElementById(a),l=k.getContext("2d");try{try{j=l.getImageData(b,c,g,h)}catch(m){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),j=l.getImageData(b,c,g,h)}catch(m){throw alert("Cannot access local image"),new Error("unable to access local image data: "+m)}}}catch(m){throw alert("Cannot access image"),new Error("unable to access image data: "+m)}var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=j.data,M=i+i+1,N=g-1,O=h-1,P=i+1,Q=P*(P+1)/2,R=new d,S=R;for(p=1;M>p;p++)if(S=S.next=new d,p==P)var T=S;S.next=R;var U=null,V=null;t=s=0;var W=e[i],X=f[i];for(o=0;h>o;o++){for(C=D=E=F=u=v=w=x=0,y=P*(G=L[s]),z=P*(H=L[s+1]),A=P*(I=L[s+2]),B=P*(J=L[s+3]),u+=Q*G,v+=Q*H,w+=Q*I,x+=Q*J,S=R,p=0;P>p;p++)S.r=G,S.g=H,S.b=I,S.a=J,S=S.next;for(p=1;P>p;p++)q=s+((p>N?N:p)<<2),u+=(S.r=G=L[q])*(K=P-p),v+=(S.g=H=L[q+1])*K,w+=(S.b=I=L[q+2])*K,x+=(S.a=J=L[q+3])*K,C+=G,D+=H,E+=I,F+=J,S=S.next;for(U=R,V=T,n=0;g>n;n++)L[s+3]=J=x*W>>X,0!=J?(J=255/J,L[s]=(u*W>>X)*J,L[s+1]=(v*W>>X)*J,L[s+2]=(w*W>>X)*J):L[s]=L[s+1]=L[s+2]=0,u-=y,v-=z,w-=A,x-=B,y-=U.r,z-=U.g,A-=U.b,B-=U.a,q=t+((q=n+i+1)<N?q:N)<<2,C+=U.r=L[q],D+=U.g=L[q+1],E+=U.b=L[q+2],F+=U.a=L[q+3],u+=C,v+=D,w+=E,x+=F,U=U.next,y+=G=V.r,z+=H=V.g,A+=I=V.b,B+=J=V.a,C-=G,D-=H,E-=I,F-=J,V=V.next,s+=4;t+=g}for(n=0;g>n;n++){for(D=E=F=C=v=w=x=u=0,s=n<<2,y=P*(G=L[s]),z=P*(H=L[s+1]),A=P*(I=L[s+2]),B=P*(J=L[s+3]),u+=Q*G,v+=Q*H,w+=Q*I,x+=Q*J,S=R,p=0;P>p;p++)S.r=G,S.g=H,S.b=I,S.a=J,S=S.next;for(r=g,p=1;i>=p;p++)s=r+n<<2,u+=(S.r=G=L[s])*(K=P-p),v+=(S.g=H=L[s+1])*K,w+=(S.b=I=L[s+2])*K,x+=(S.a=J=L[s+3])*K,C+=G,D+=H,E+=I,F+=J,S=S.next,O>p&&(r+=g);for(s=n,U=R,V=T,o=0;h>o;o++)q=s<<2,L[q+3]=J=x*W>>X,J>0?(J=255/J,L[q]=(u*W>>X)*J,L[q+1]=(v*W>>X)*J,L[q+2]=(w*W>>X)*J):L[q]=L[q+1]=L[q+2]=0,u-=y,v-=z,w-=A,x-=B,y-=U.r,z-=U.g,A-=U.b,B-=U.a,q=n+((q=o+P)<O?q:O)*g<<2,u+=C+=U.r=L[q],v+=D+=U.g=L[q+1],w+=E+=U.b=L[q+2],x+=F+=U.a=L[q+3],U=U.next,y+=G=V.r,z+=H=V.g,A+=I=V.b,B+=J=V.a,C-=G,D-=H,E-=I,F-=J,V=V.next,s+=g}l.putImageData(j,b,c)}}function d(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],f=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return function(){function a(){var a={};return a.FRAMERATE=30,a.MAX_VIRTUAL_PIXELS=3e4,a.init=function(b){var c=0;a.UniqueId=function(){return c++,"canvg"+c},a.Definitions={},a.Styles={},a.Animations=[],a.Images=[],a.ctx=b,a.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},a.init(),a.ImagesLoaded=function(){for(var b=0;b<a.Images.length;b++)if(!a.Images[b].loaded)return!1;return!0},a.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},a.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm," ")},a.ajax=function(a){var b;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b?(b.open("GET",a,!1),b.send(null),b.responseText):null},a.parseXml=function(a){if(window.DOMParser){var b=new DOMParser;return b.parseFromString(a,"text/xml")}a=a.replace(/<!DOCTYPE svg[^>]*>/,"");var c=new ActiveXObject("Microsoft.XMLDOM");return c.async="false",c.loadXML(a),c},a.Property=function(a,b){this.name=a,this.value=b},a.Property.prototype.getValue=function(){return this.value},a.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},a.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);return(this.value+"").match(/%$/)&&(a/=100),a},a.Property.prototype.valueOrDefault=function(a){return this.hasValue()?this.value:a},a.Property.prototype.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a},a.Property.prototype.addOpacity=function(c){var d=this.value;if(null!=c&&""!=c&&"string"==typeof this.value){var e=new b(this.value);e.ok&&(d="rgba("+e.r+", "+e.g+", "+e.b+", "+c+")")}return new a.Property(this.name,d)},a.Property.prototype.getDefinition=function(){var b=this.value.match(/#([^\)'"]+)/);return b&&(b=b[1]),b||(b=this.value),a.Definitions[b]},a.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},a.Property.prototype.getFillStyleDefinition=function(b,c){var d=this.getDefinition();if(null!=d&&d.createGradient)return d.createGradient(a.ctx,b,c);if(null!=d&&d.createPattern){if(d.getHrefAttribute().hasValue()){var e=d.attribute("patternTransform");d=d.getHrefAttribute().getDefinition(),e.hasValue()&&(d.attribute("patternTransform",!0).value=e.value)}return d.createPattern(a.ctx,b)}return null},a.Property.prototype.getDPI=function(a){return 96},a.Property.prototype.getEM=function(b){var c=12,d=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);return d.hasValue()&&(c=d.toPixels(b)),c},a.Property.prototype.getUnits=function(){var a=this.value+"";return a.replace(/[0-9\.\-]/g,"")},a.Property.prototype.toPixels=function(b,c){if(!this.hasValue())return 0;var d=this.value+"";if(d.match(/em$/))return this.numValue()*this.getEM(b);if(d.match(/ex$/))return this.numValue()*this.getEM(b)/2;if(d.match(/px$/))return this.numValue();if(d.match(/pt$/))return this.numValue()*this.getDPI(b)*(1/72);if(d.match(/pc$/))return 15*this.numValue();if(d.match(/cm$/))return this.numValue()*this.getDPI(b)/2.54;if(d.match(/mm$/))return this.numValue()*this.getDPI(b)/25.4;if(d.match(/in$/))return this.numValue()*this.getDPI(b);if(d.match(/%$/))return this.numValue()*a.ViewPort.ComputeSize(b);var e=this.numValue();return c&&1>e?e*a.ViewPort.ComputeSize(b):e},a.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/s$/)?1e3*this.numValue():a.match(/ms$/)?this.numValue():this.numValue()},a.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var a=this.value+"";return a.match(/deg$/)?this.numValue()*(Math.PI/180):a.match(/grad$/)?this.numValue()*(Math.PI/200):a.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},a.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(b,c,d,e,f,g){var h=null!=g?this.Parse(g):this.CreateFont("","","","","",a.ctx.font);return{fontFamily:f||h.fontFamily,fontSize:e||h.fontSize,fontStyle:b||h.fontStyle,fontWeight:d||h.fontWeight,fontVariant:c||h.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var b=this;this.Parse=function(c){for(var d={},e=a.trim(a.compressSpaces(c||"")).split(" "),f={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},g="",h=0;h<e.length;h++)f.fontStyle||-1==b.Styles.indexOf(e[h])?f.fontVariant||-1==b.Variants.indexOf(e[h])?f.fontWeight||-1==b.Weights.indexOf(e[h])?f.fontSize?"inherit"!=e[h]&&(g+=e[h]):("inherit"!=e[h]&&(d.fontSize=e[h].split("/")[0]),f.fontStyle=f.fontVariant=f.fontWeight=f.fontSize=!0):("inherit"!=e[h]&&(d.fontWeight=e[h]),f.fontStyle=f.fontVariant=f.fontWeight=!0):("inherit"!=e[h]&&(d.fontVariant=e[h]),f.fontStyle=f.fontVariant=!0):("inherit"!=e[h]&&(d.fontStyle=e[h]),f.fontStyle=!0);return""!=g&&(d.fontFamily=g),d}},a.ToNumberArray=function(b){for(var c=a.trim(a.compressSpaces((b||"").replace(/,/g," "))).split(" "),d=0;d<c.length;d++)c[d]=parseFloat(c[d]);return c},a.Point=function(a,b){this.x=a,this.y=b},a.Point.prototype.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},a.Point.prototype.applyTransform=function(a){var b=this.x*a[0]+this.y*a[2]+a[4],c=this.x*a[1]+this.y*a[3]+a[5];this.x=b,this.y=c},a.CreatePoint=function(b){var c=a.ToNumberArray(b);return new a.Point(c[0],c[1])},a.CreatePath=function(b){for(var c=a.ToNumberArray(b),d=[],e=0;e<c.length;e+=2)d.push(new a.Point(c[e],c[e+1]));return d},a.BoundingBox=function(a,b,c,d){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(a,b){null!=a&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=a,this.x2=a),a<this.x1&&(this.x1=a),a>this.x2&&(this.x2=a)),null!=b&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=b,this.y2=b),b<this.y1&&(this.y1=b),b>this.y2&&(this.y2=b))},this.addX=function(a){this.addPoint(a,null)},this.addY=function(a){this.addPoint(null,a)},this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1),this.addPoint(a.x2,a.y2)},this.addQuadraticCurve=function(a,b,c,d,e,f){var g=a+2/3*(c-a),h=b+2/3*(d-b),i=g+1/3*(e-a),j=h+1/3*(f-b);this.addBezierCurve(a,b,g,i,h,j,e,f)},this.addBezierCurve=function(a,b,c,d,e,f,g,h){var j=[a,b],k=[c,d],l=[e,f],m=[g,h];for(this.addPoint(j[0],j[1]),this.addPoint(m[0],m[1]),i=0;i<=1;i++){var n=function(a){return Math.pow(1-a,3)*j[i]+3*Math.pow(1-a,2)*a*k[i]+3*(1-a)*Math.pow(a,2)*l[i]+Math.pow(a,3)*m[i]},o=6*j[i]-12*k[i]+6*l[i],p=-3*j[i]+9*k[i]-9*l[i]+3*m[i],q=3*k[i]-3*j[i];if(0!=p){var r=Math.pow(o,2)-4*q*p;if(!(0>r)){var s=(-o+Math.sqrt(r))/(2*p);s>0&&1>s&&(0==i&&this.addX(n(s)),1==i&&this.addY(n(s)));var t=(-o-Math.sqrt(r))/(2*p);t>0&&1>t&&(0==i&&this.addX(n(t)),1==i&&this.addY(n(t)))}}else{if(0==o)continue;var u=-q/o;u>0&&1>u&&(0==i&&this.addX(n(u)),1==i&&this.addY(n(u)))}}},this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2},this.addPoint(a,b),this.addPoint(c,d)},a.Transform=function(b){var c=this;this.Type={},this.Type.translate=function(b){this.p=a.CreatePoint(b),this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)},this.unapply=function(a){a.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(b){var c=a.ToNumberArray(b);this.angle=new a.Property("angle",c[0]),this.cx=c[1]||0,this.cy=c[2]||0,this.apply=function(a){a.translate(this.cx,this.cy),a.rotate(this.angle.toRadians()),a.translate(-this.cx,-this.cy)},this.unapply=function(a){a.translate(this.cx,this.cy),a.rotate(-1*this.angle.toRadians()),a.translate(-this.cx,-this.cy)},this.applyToPoint=function(a){var b=this.angle.toRadians();a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]),a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(b){this.p=a.CreatePoint(b),this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(a){a.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(b){this.m=a.ToNumberArray(b),this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(a){a.applyTransform(this.m)}},this.Type.SkewBase=function(b){this.base=c.Type.matrix,this.base(b),this.angle=new a.Property("angle",b)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(a){this.base=c.Type.SkewBase,this.base(a),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(a){this.base=c.Type.SkewBase,this.base(a),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)},this.unapply=function(a){for(var b=this.transforms.length-1;b>=0;b--)this.transforms[b].unapply(a)},this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};for(var d=a.trim(a.compressSpaces(b)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),e=0;e<d.length;e++){var f=a.trim(d[e].split("(")[0]),g=d[e].split("(")[1].replace(")",""),h=new this.Type[f](g);h.type=f,this.transforms.push(h)}},a.AspectRatio=function(b,c,d,e,f,g,h,i,j,k){c=a.compressSpaces(c),c=c.replace(/^defer\s/,"");var l=c.split(" ")[0]||"xMidYMid",m=c.split(" ")[1]||"meet",n=d/e,o=f/g,p=Math.min(n,o),q=Math.max(n,o);"meet"==m&&(e*=p,g*=p),"slice"==m&&(e*=q,g*=q),j=new a.Property("refX",j),k=new a.Property("refY",k),j.hasValue()&&k.hasValue()?b.translate(-p*j.toPixels("x"),-p*k.toPixels("y")):(l.match(/^xMid/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&b.translate(d/2-e/2,0),l.match(/YMid$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&b.translate(0,f/2-g/2),l.match(/^xMax/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&b.translate(d-e,0),l.match(/YMax$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&b.translate(0,f-g)),"none"==l?b.scale(n,o):"meet"==m?b.scale(p,p):"slice"==m&&b.scale(q,q),b.translate(null==h?0:-h,null==i?0:-i)},a.Element={},a.EmptyProperty=new a.Property("EMPTY",""),a.Element.ElementBase=function(b){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(b,c){var d=this.attributes[b];return null!=d?d:(1==c&&(d=new a.Property(b,""),this.attributes[b]=d),d||a.EmptyProperty)},this.getHrefAttribute=function(){for(var b in this.attributes)if(b.match(/:href$/))return this.attributes[b];return a.EmptyProperty},this.style=function(b,c){var d=this.styles[b];if(null!=d)return d;var e=this.attribute(b);if(null!=e&&e.hasValue())return this.styles[b]=e,e;var f=this.parent;if(null!=f){var g=f.style(b);if(null!=g&&g.hasValue())return g}return 1==c&&(d=new a.Property(b,""),this.styles[b]=d),d||a.EmptyProperty},this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(a.save(),this.attribute("mask").hasValue()){var b=this.attribute("mask").getDefinition();null!=b&&b.apply(a,this)}else if(this.style("filter").hasValue()){var c=this.style("filter").getDefinition();null!=c&&c.apply(a,this)}else this.setContext(a),this.renderChildren(a),this.clearContext(a);a.restore()}},this.setContext=function(a){},this.clearContext=function(a){},this.renderChildren=function(a){for(var b=0;b<this.children.length;b++)this.children[b].render(a)},this.addChild=function(b,c){var d=b;c&&(d=a.CreateElement(b)),d.parent=this,this.children.push(d)},null!=b&&1==b.nodeType){for(var c=0;c<b.childNodes.length;c++){var d=b.childNodes[c];if(1==d.nodeType&&this.addChild(d,!0),this.captureTextNodes&&3==d.nodeType){var e=d.nodeValue||d.text||"";""!=a.trim(a.compressSpaces(e))&&this.addChild(new a.Element.tspan(d),!1)}}for(var c=0;c<b.attributes.length;c++){var f=b.attributes[c];this.attributes[f.nodeName]=new a.Property(f.nodeName,f.nodeValue)}var g=a.Styles[b.nodeName];if(null!=g)for(var h in g)this.styles[h]=g[h];if(this.attribute("class").hasValue())for(var i=a.compressSpaces(this.attribute("class").value).split(" "),j=0;j<i.length;j++){if(g=a.Styles["."+i[j]],null!=g)for(var h in g)this.styles[h]=g[h];if(g=a.Styles[b.nodeName+"."+i[j]],null!=g)for(var h in g)this.styles[h]=g[h]}if(this.attribute("id").hasValue()){var g=a.Styles["#"+this.attribute("id").value];if(null!=g)for(var h in g)this.styles[h]=g[h]}if(this.attribute("style").hasValue())for(var g=this.attribute("style").value.split(";"),c=0;c<g.length;c++)if(""!=a.trim(g[c])){var k=g[c].split(":"),h=a.trim(k[0]),l=a.trim(k[1]);this.styles[h]=new a.Property(h,l)}this.attribute("id").hasValue()&&null==a.Definitions[this.attribute("id").value]&&(a.Definitions[this.attribute("id").value]=this)}},a.Element.RenderedElementBase=function(b){this.base=a.Element.ElementBase,this.base(b),this.setContext=function(b){if(this.style("fill").isUrlDefinition()){var c=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));null!=c&&(b.fillStyle=c)}else if(this.style("fill").hasValue()){var d=this.style("fill");"currentColor"==d.value&&(d.value=this.style("color").value),b.fillStyle="none"==d.value?"rgba(0,0,0,0)":d.value}if(this.style("fill-opacity").hasValue()){var d=new a.Property("fill",b.fillStyle);d=d.addOpacity(this.style("fill-opacity").value),b.fillStyle=d.value}if(this.style("stroke").isUrlDefinition()){var c=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));null!=c&&(b.strokeStyle=c)}else if(this.style("stroke").hasValue()){var e=this.style("stroke");"currentColor"==e.value&&(e.value=this.style("color").value),b.strokeStyle="none"==e.value?"rgba(0,0,0,0)":e.value}if(this.style("stroke-opacity").hasValue()){var e=new a.Property("stroke",b.strokeStyle);e=e.addOpacity(this.style("stroke-opacity").value),b.strokeStyle=e.value}if(this.style("stroke-width").hasValue()){var f=this.style("stroke-width").toPixels();b.lineWidth=0==f?.001:f}if(this.style("stroke-linecap").hasValue()&&(b.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(b.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(b.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()){var g=a.ToNumberArray(this.style("stroke-dasharray").value);"undefined"!=typeof b.setLineDash?b.setLineDash(g):"undefined"!=typeof b.webkitLineDash?b.webkitLineDash=g:"undefined"!=typeof b.mozDash&&(b.mozDash=g);var h=this.style("stroke-dashoffset").numValueOrDefault(1);"undefined"!=typeof b.lineDashOffset?b.lineDashOffset=h:"undefined"!=typeof b.webkitLineDashOffset?b.webkitLineDashOffset=h:"undefined"!=typeof b.mozDashOffset&&(b.mozDashOffset=h)}if("undefined"!=typeof b.font&&(b.font=a.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var i=new a.Transform(this.attribute("transform").value);i.apply(b)}if(this.style("clip-path").hasValue()){var j=this.style("clip-path").getDefinition();null!=j&&j.apply(b)}this.style("opacity").hasValue()&&(b.globalAlpha=this.style("opacity").numValue())}},a.Element.RenderedElementBase.prototype=new a.Element.ElementBase,a.Element.PathElementBase=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.path=function(b){return null!=b&&b.beginPath(),new a.BoundingBox},this.renderChildren=function(b){this.path(b),a.Mouse.checkPath(this,b),""!=b.fillStyle&&(this.attribute("fill-rule").hasValue()?b.fill(this.attribute("fill-rule").value):b.fill()),""!=b.strokeStyle&&b.stroke();var c=this.getMarkers();if(null!=c){if(this.style("marker-start").isUrlDefinition()){var d=this.style("marker-start").getDefinition();d.render(b,c[0][0],c[0][1])}if(this.style("marker-mid").isUrlDefinition())for(var d=this.style("marker-mid").getDefinition(),e=1;e<c.length-1;e++)d.render(b,c[e][0],c[e][1]);if(this.style("marker-end").isUrlDefinition()){var d=this.style("marker-end").getDefinition();d.render(b,c[c.length-1][0],c[c.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},a.Element.PathElementBase.prototype=new a.Element.RenderedElementBase,a.Element.svg=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.baseClearContext=this.clearContext,this.clearContext=function(b){this.baseClearContext(b),a.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(b){b.strokeStyle="rgba(0,0,0,0)",b.lineCap="butt",b.lineJoin="miter",b.miterLimit=4,this.baseSetContext(b),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),b.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var c=a.ViewPort.width(),d=a.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),"undefined"==typeof this.root){c=this.attribute("width").toPixels("x"),d=this.attribute("height").toPixels("y");var e=0,f=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(e=-this.attribute("refX").toPixels("x"),f=-this.attribute("refY").toPixels("y")),b.beginPath(),b.moveTo(e,f),b.lineTo(c,f),b.lineTo(c,d),b.lineTo(e,d),b.closePath(),b.clip()}if(a.ViewPort.SetCurrent(c,d),this.attribute("viewBox").hasValue()){var g=a.ToNumberArray(this.attribute("viewBox").value),h=g[0],i=g[1];c=g[2],d=g[3],a.AspectRatio(b,this.attribute("preserveAspectRatio").value,a.ViewPort.width(),c,a.ViewPort.height(),d,h,i,this.attribute("refX").value,this.attribute("refY").value),a.ViewPort.RemoveCurrent(),a.ViewPort.SetCurrent(g[2],g[3])}}},a.Element.svg.prototype=new a.Element.RenderedElementBase,a.Element.rect=function(b){this.base=a.Element.PathElementBase,this.base(b),this.path=function(b){var c=this.attribute("x").toPixels("x"),d=this.attribute("y").toPixels("y"),e=this.attribute("width").toPixels("x"),f=this.attribute("height").toPixels("y"),g=this.attribute("rx").toPixels("x"),h=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(h=g),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(g=h),g=Math.min(g,e/2),h=Math.min(h,f/2),null!=b&&(b.beginPath(),b.moveTo(c+g,d),b.lineTo(c+e-g,d),b.quadraticCurveTo(c+e,d,c+e,d+h),b.lineTo(c+e,d+f-h),b.quadraticCurveTo(c+e,d+f,c+e-g,d+f),b.lineTo(c+g,d+f),b.quadraticCurveTo(c,d+f,c,d+f-h),b.lineTo(c,d+h),b.quadraticCurveTo(c,d,c+g,d),b.closePath()),new a.BoundingBox(c,d,c+e,d+f)}},a.Element.rect.prototype=new a.Element.PathElementBase,a.Element.circle=function(b){this.base=a.Element.PathElementBase,this.base(b),this.path=function(b){var c=this.attribute("cx").toPixels("x"),d=this.attribute("cy").toPixels("y"),e=this.attribute("r").toPixels();return null!=b&&(b.beginPath(),b.arc(c,d,e,0,2*Math.PI,!0),b.closePath()),new a.BoundingBox(c-e,d-e,c+e,d+e)}},a.Element.circle.prototype=new a.Element.PathElementBase,a.Element.ellipse=function(b){this.base=a.Element.PathElementBase,this.base(b),this.path=function(b){var c=4*((Math.sqrt(2)-1)/3),d=this.attribute("rx").toPixels("x"),e=this.attribute("ry").toPixels("y"),f=this.attribute("cx").toPixels("x"),g=this.attribute("cy").toPixels("y");return null!=b&&(b.beginPath(),b.moveTo(f,g-e),b.bezierCurveTo(f+c*d,g-e,f+d,g-c*e,f+d,g),b.bezierCurveTo(f+d,g+c*e,f+c*d,g+e,f,g+e),b.bezierCurveTo(f-c*d,g+e,f-d,g+c*e,f-d,g),b.bezierCurveTo(f-d,g-c*e,f-c*d,g-e,f,g-e),b.closePath()),new a.BoundingBox(f-d,g-e,f+d,g+e)}},a.Element.ellipse.prototype=new a.Element.PathElementBase,a.Element.line=function(b){this.base=a.Element.PathElementBase,this.base(b),this.getPoints=function(){return[new a.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new a.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(b){var c=this.getPoints();return null!=b&&(b.beginPath(),b.moveTo(c[0].x,c[0].y),b.lineTo(c[1].x,c[1].y)),new a.BoundingBox(c[0].x,c[0].y,c[1].x,c[1].y)},this.getMarkers=function(){var a=this.getPoints(),b=a[0].angleTo(a[1]);return[[a[0],b],[a[1],b]]}},a.Element.line.prototype=new a.Element.PathElementBase,a.Element.polyline=function(b){this.base=a.Element.PathElementBase,this.base(b),this.points=a.CreatePath(this.attribute("points").value),this.path=function(b){var c=new a.BoundingBox(this.points[0].x,this.points[0].y);null!=b&&(b.beginPath(),b.moveTo(this.points[0].x,this.points[0].y));for(var d=1;d<this.points.length;d++)c.addPoint(this.points[d].x,this.points[d].y),null!=b&&b.lineTo(this.points[d].x,this.points[d].y);return c},this.getMarkers=function(){for(var a=[],b=0;b<this.points.length-1;b++)a.push([this.points[b],this.points[b].angleTo(this.points[b+1])]);return a.push([this.points[this.points.length-1],a[a.length-1][1]]),a}},a.Element.polyline.prototype=new a.Element.PathElementBase,a.Element.polygon=function(b){this.base=a.Element.polyline,this.base(b),this.basePath=this.path,this.path=function(a){var b=this.basePath(a);return null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath()),b}},a.Element.polygon.prototype=new a.Element.polyline,a.Element.path=function(b){this.base=a.Element.PathElementBase,this.base(b);var c=this.attribute("d").value;c=c.replace(/,/gm," "),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),c=c.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([0-9])([+\-])/gm,"$1 $2"),c=c.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),c=c.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),c=a.compressSpaces(c),c=a.trim(c),this.PathParser=new function(b){this.tokens=b.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new a.Point(0,0),this.control=new a.Point(0,0),this.current=new a.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){
case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var b=new a.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(b)},this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a,a},this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a,a},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var b=new a.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return b},this.makeAbsolute=function(a){return this.isRelativeCommand()&&(a.x+=this.current.x,a.y+=this.current.y),a},this.addMarker=function(a,b,c){null!=c&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(c)),this.addMarkerAngle(a,null==b?null:b.angleTo(a))},this.addMarkerAngle=function(a,b){this.points.push(a),this.angles.push(b)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(c),this.path=function(b){var c=this.PathParser;c.reset();var d=new a.BoundingBox;for(null!=b&&b.beginPath();!c.isEnd();)switch(c.nextCommand(),c.command){case"M":case"m":var e=c.getAsCurrentPoint();for(c.addMarker(e),d.addPoint(e.x,e.y),null!=b&&b.moveTo(e.x,e.y),c.start=c.current;!c.isCommandOrEnd();){var e=c.getAsCurrentPoint();c.addMarker(e,c.start),d.addPoint(e.x,e.y),null!=b&&b.lineTo(e.x,e.y)}break;case"L":case"l":for(;!c.isCommandOrEnd();){var f=c.current,e=c.getAsCurrentPoint();c.addMarker(e,f),d.addPoint(e.x,e.y),null!=b&&b.lineTo(e.x,e.y)}break;case"H":case"h":for(;!c.isCommandOrEnd();){var g=new a.Point((c.isRelativeCommand()?c.current.x:0)+c.getScalar(),c.current.y);c.addMarker(g,c.current),c.current=g,d.addPoint(c.current.x,c.current.y),null!=b&&b.lineTo(c.current.x,c.current.y)}break;case"V":case"v":for(;!c.isCommandOrEnd();){var g=new a.Point(c.current.x,(c.isRelativeCommand()?c.current.y:0)+c.getScalar());c.addMarker(g,c.current),c.current=g,d.addPoint(c.current.x,c.current.y),null!=b&&b.lineTo(c.current.x,c.current.y)}break;case"C":case"c":for(;!c.isCommandOrEnd();){var h=c.current,i=c.getPoint(),j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,i),d.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=b&&b.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"S":case"s":for(;!c.isCommandOrEnd();){var h=c.current,i=c.getReflectedControlPoint(),j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,i),d.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=b&&b.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"Q":case"q":for(;!c.isCommandOrEnd();){var h=c.current,j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,j),d.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=b&&b.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"T":case"t":for(;!c.isCommandOrEnd();){var h=c.current,j=c.getReflectedControlPoint();c.control=j;var k=c.getAsCurrentPoint();c.addMarker(k,j,j),d.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=b&&b.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"A":case"a":for(;!c.isCommandOrEnd();){var h=c.current,l=c.getScalar(),m=c.getScalar(),n=c.getScalar()*(Math.PI/180),o=c.getScalar(),p=c.getScalar(),k=c.getAsCurrentPoint(),q=new a.Point(Math.cos(n)*(h.x-k.x)/2+Math.sin(n)*(h.y-k.y)/2,-Math.sin(n)*(h.x-k.x)/2+Math.cos(n)*(h.y-k.y)/2),r=Math.pow(q.x,2)/Math.pow(l,2)+Math.pow(q.y,2)/Math.pow(m,2);r>1&&(l*=Math.sqrt(r),m*=Math.sqrt(r));var s=(o==p?-1:1)*Math.sqrt((Math.pow(l,2)*Math.pow(m,2)-Math.pow(l,2)*Math.pow(q.y,2)-Math.pow(m,2)*Math.pow(q.x,2))/(Math.pow(l,2)*Math.pow(q.y,2)+Math.pow(m,2)*Math.pow(q.x,2)));isNaN(s)&&(s=0);var t=new a.Point(s*l*q.y/m,s*-m*q.x/l),u=new a.Point((h.x+k.x)/2+Math.cos(n)*t.x-Math.sin(n)*t.y,(h.y+k.y)/2+Math.sin(n)*t.x+Math.cos(n)*t.y),v=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))},w=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(v(a)*v(b))},x=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(w(a,b))},y=x([1,0],[(q.x-t.x)/l,(q.y-t.y)/m]),z=[(q.x-t.x)/l,(q.y-t.y)/m],A=[(-q.x-t.x)/l,(-q.y-t.y)/m],B=x(z,A);w(z,A)<=-1&&(B=Math.PI),w(z,A)>=1&&(B=0);var C=1-p?1:-1,D=y+C*(B/2),E=new a.Point(u.x+l*Math.cos(D),u.y+m*Math.sin(D));if(c.addMarkerAngle(E,D-C*Math.PI/2),c.addMarkerAngle(k,D-C*Math.PI),d.addPoint(k.x,k.y),null!=b){var w=l>m?l:m,F=l>m?1:l/m,G=l>m?m/l:1;b.translate(u.x,u.y),b.rotate(n),b.scale(F,G),b.arc(0,0,w,y,y+B,1-p),b.scale(1/F,1/G),b.rotate(-n),b.translate(-u.x,-u.y)}}break;case"Z":case"z":null!=b&&b.closePath(),c.current=c.start}return d},this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],d=0;d<a.length;d++)c.push([a[d],b[d]]);return c}},a.Element.path.prototype=new a.Element.PathElementBase,a.Element.pattern=function(b){this.base=a.Element.ElementBase,this.base(b),this.createPattern=function(b,c){var d=this.attribute("width").toPixels("x",!0),e=this.attribute("height").toPixels("y",!0),f=new a.Element.svg;f.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value),f.attributes.width=new a.Property("width",d+"px"),f.attributes.height=new a.Property("height",e+"px"),f.attributes.transform=new a.Property("transform",this.attribute("patternTransform").value),f.children=this.children;var g=document.createElement("canvas");g.width=d,g.height=e;var h=g.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&h.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var i=-1;1>=i;i++)for(var j=-1;1>=j;j++)h.save(),h.translate(i*g.width,j*g.height),f.render(h),h.restore();var k=b.createPattern(g,"repeat");return k}},a.Element.pattern.prototype=new a.Element.ElementBase,a.Element.marker=function(b){this.base=a.Element.ElementBase,this.base(b),this.baseRender=this.render,this.render=function(b,c,d){b.translate(c.x,c.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(d),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(b.lineWidth,b.lineWidth),b.save();var e=new a.Element.svg;e.attributes.viewBox=new a.Property("viewBox",this.attribute("viewBox").value),e.attributes.refX=new a.Property("refX",this.attribute("refX").value),e.attributes.refY=new a.Property("refY",this.attribute("refY").value),e.attributes.width=new a.Property("width",this.attribute("markerWidth").value),e.attributes.height=new a.Property("height",this.attribute("markerHeight").value),e.attributes.fill=new a.Property("fill",this.attribute("fill").valueOrDefault("black")),e.attributes.stroke=new a.Property("stroke",this.attribute("stroke").valueOrDefault("none")),e.children=this.children,e.render(b),b.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&b.scale(1/b.lineWidth,1/b.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&b.rotate(-d),b.translate(-c.x,-c.y)}},a.Element.marker.prototype=new a.Element.ElementBase,a.Element.defs=function(b){this.base=a.Element.ElementBase,this.base(b),this.render=function(a){}},a.Element.defs.prototype=new a.Element.ElementBase,a.Element.GradientBase=function(b){this.base=a.Element.ElementBase,this.base(b),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var c=0;c<this.children.length;c++){var d=this.children[c];"stop"==d.type&&this.stops.push(d)}this.getGradient=function(){},this.createGradient=function(b,c,d){var e=this;this.getHrefAttribute().hasValue()&&(e=this.getHrefAttribute().getDefinition());var f=function(b){if(d.hasValue()){var c=new a.Property("color",b);return c.addOpacity(d.value).value}return b},g=this.getGradient(b,c);if(null==g)return f(e.stops[e.stops.length-1].color);for(var h=0;h<e.stops.length;h++)g.addColorStop(e.stops[h].offset,f(e.stops[h].color));if(this.attribute("gradientTransform").hasValue()){var i=a.ViewPort.viewPorts[0],j=new a.Element.rect;j.attributes.x=new a.Property("x",-a.MAX_VIRTUAL_PIXELS/3),j.attributes.y=new a.Property("y",-a.MAX_VIRTUAL_PIXELS/3),j.attributes.width=new a.Property("width",a.MAX_VIRTUAL_PIXELS),j.attributes.height=new a.Property("height",a.MAX_VIRTUAL_PIXELS);var k=new a.Element.g;k.attributes.transform=new a.Property("transform",this.attribute("gradientTransform").value),k.children=[j];var l=new a.Element.svg;l.attributes.x=new a.Property("x",0),l.attributes.y=new a.Property("y",0),l.attributes.width=new a.Property("width",i.width),l.attributes.height=new a.Property("height",i.height),l.children=[k];var m=document.createElement("canvas");m.width=i.width,m.height=i.height;var n=m.getContext("2d");return n.fillStyle=g,l.render(n),n.createPattern(m,"no-repeat")}return g}},a.Element.GradientBase.prototype=new a.Element.ElementBase,a.Element.linearGradient=function(b){this.base=a.Element.GradientBase,this.base(b),this.getGradient=function(a,b){var c=b.getBoundingBox();this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var d="objectBoundingBox"==this.gradientUnits?c.x()+c.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),e="objectBoundingBox"==this.gradientUnits?c.y()+c.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),f="objectBoundingBox"==this.gradientUnits?c.x()+c.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),g="objectBoundingBox"==this.gradientUnits?c.y()+c.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return d==f&&e==g?null:a.createLinearGradient(d,e,f,g)}},a.Element.linearGradient.prototype=new a.Element.GradientBase,a.Element.radialGradient=function(b){this.base=a.Element.GradientBase,this.base(b),this.getGradient=function(a,b){var c=b.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var d="objectBoundingBox"==this.gradientUnits?c.x()+c.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),e="objectBoundingBox"==this.gradientUnits?c.y()+c.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),f=d,g=e;this.attribute("fx").hasValue()&&(f="objectBoundingBox"==this.gradientUnits?c.x()+c.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(g="objectBoundingBox"==this.gradientUnits?c.y()+c.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var h="objectBoundingBox"==this.gradientUnits?(c.width()+c.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return a.createRadialGradient(f,g,0,d,e,h)}},a.Element.radialGradient.prototype=new a.Element.GradientBase,a.Element.stop=function(b){this.base=a.Element.ElementBase,this.base(b),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var c=this.style("stop-color");this.style("stop-opacity").hasValue()&&(c=c.addOpacity(this.style("stop-opacity").value)),this.color=c.value},a.Element.stop.prototype=new a.Element.ElementBase,a.Element.AnimateBase=function(b){this.base=a.Element.ElementBase,this.base(b),a.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var a=this.attribute("attributeType").value,b=this.attribute("attributeName").value;return"CSS"==a?this.parent.style(b,!0):this.parent.attribute(b,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(a){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value&&"indefinite"!=this.attribute("repeatDur").value)return"remove"!=this.attribute("fill").valueOrDefault("remove")||this.removed?!1:(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+a;var b=!1;if(this.begin<this.duration){var c=this.calcValue();if(this.attribute("type").hasValue()){var d=this.attribute("type").value;c=d+"("+c+")"}this.getProperty().value=c,b=!0}return b},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var b={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var c=b.progress*(this.values.value.length-1),d=Math.floor(c),e=Math.ceil(c);b.from=new a.Property("from",parseFloat(this.values.value[d])),b.to=new a.Property("to",parseFloat(this.values.value[e])),b.progress=(c-d)/(e-d)}else b.from=this.from,b.to=this.to;return b}},a.Element.AnimateBase.prototype=new a.Element.ElementBase,a.Element.animate=function(b){this.base=a.Element.AnimateBase,this.base(b),this.calcValue=function(){var a=this.progress(),b=a.from.numValue()+(a.to.numValue()-a.from.numValue())*a.progress;return b+this.initialUnits}},a.Element.animate.prototype=new a.Element.AnimateBase,a.Element.animateColor=function(c){this.base=a.Element.AnimateBase,this.base(c),this.calcValue=function(){var a=this.progress(),c=new b(a.from.value),d=new b(a.to.value);if(c.ok&&d.ok){var e=c.r+(d.r-c.r)*a.progress,f=c.g+(d.g-c.g)*a.progress,g=c.b+(d.b-c.b)*a.progress;return"rgb("+parseInt(e,10)+","+parseInt(f,10)+","+parseInt(g,10)+")"}return this.attribute("from").value}},a.Element.animateColor.prototype=new a.Element.AnimateBase,a.Element.animateTransform=function(b){this.base=a.Element.AnimateBase,this.base(b),this.calcValue=function(){for(var b=this.progress(),c=a.ToNumberArray(b.from.value),d=a.ToNumberArray(b.to.value),e="",f=0;f<c.length;f++)e+=c[f]+(d[f]-c[f])*b.progress+" ";return e}},a.Element.animateTransform.prototype=new a.Element.animate,a.Element.font=function(b){this.base=a.Element.ElementBase,this.base(b),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var c=0;c<this.children.length;c++){var d=this.children[c];"font-face"==d.type?(this.fontFace=d,d.style("font-family").hasValue()&&(a.Definitions[d.style("font-family").value]=this)):"missing-glyph"==d.type?this.missingGlyph=d:"glyph"==d.type&&(""!=d.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[d.unicode]&&(this.glyphs[d.unicode]=[]),this.glyphs[d.unicode][d.arabicForm]=d):this.glyphs[d.unicode]=d)}},a.Element.font.prototype=new a.Element.ElementBase,a.Element.fontface=function(b){this.base=a.Element.ElementBase,this.base(b),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},a.Element.fontface.prototype=new a.Element.ElementBase,a.Element.missingglyph=function(b){this.base=a.Element.path,this.base(b),this.horizAdvX=0},a.Element.missingglyph.prototype=new a.Element.path,a.Element.glyph=function(b){this.base=a.Element.path,this.base(b),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},a.Element.glyph.prototype=new a.Element.path,a.Element.text=function(b){this.captureTextNodes=!0,this.base=a.Element.RenderedElementBase,this.base(b),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.style("dominant-baseline").hasValue()&&(a.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(a.textBaseline=this.style("alignment-baseline").value)},this.getBoundingBox=function(){return new a.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0)},this.renderChildren=function(a){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.x+=this.getAnchorDelta(a,this,0);for(var b=0;b<this.children.length;b++)this.renderChild(a,this,b)},this.getAnchorDelta=function(a,b,c){var d=this.style("text-anchor").valueOrDefault("start");if("start"!=d){for(var e=0,f=c;f<b.children.length;f++){var g=b.children[f];if(f>c&&g.attribute("x").hasValue())break;e+=g.measureTextRecursive(a)}return-1*("end"==d?e:e/2)}return 0},this.renderChild=function(a,b,c){var d=b.children[c];d.attribute("x").hasValue()?d.x=d.attribute("x").toPixels("x")+this.getAnchorDelta(a,b,c):(this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),d.attribute("dx").hasValue()&&(this.x+=d.attribute("dx").toPixels("x")),d.x=this.x),this.x=d.x+d.measureText(a),d.attribute("y").hasValue()?d.y=d.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),d.attribute("dy").hasValue()&&(this.y+=d.attribute("dy").toPixels("y")),d.y=this.y),this.y=d.y,d.render(a);for(var c=0;c<d.children.length;c++)this.renderChild(a,d,c)}},a.Element.text.prototype=new a.Element.RenderedElementBase,a.Element.TextElementBase=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.getGlyph=function(a,b,c){var d=b[c],e=null;if(a.isArabic){var f="isolated";(0==c||" "==b[c-1])&&c<b.length-2&&" "!=b[c+1]&&(f="terminal"),c>0&&" "!=b[c-1]&&c<b.length-2&&" "!=b[c+1]&&(f="medial"),c>0&&" "!=b[c-1]&&(c==b.length-1||" "==b[c+1])&&(f="initial"),"undefined"!=typeof a.glyphs[d]&&(e=a.glyphs[d][f],null==e&&"glyph"==a.glyphs[d].type&&(e=a.glyphs[d]))}else e=a.glyphs[d];return null==e&&(e=a.missingGlyph),e},this.renderChildren=function(b){var c=this.parent.style("font-family").getDefinition();if(null==c)""!=b.fillStyle&&b.fillText(a.compressSpaces(this.getText()),this.x,this.y),""!=b.strokeStyle&&b.strokeText(a.compressSpaces(this.getText()),this.x,this.y);else{var d=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),e=this.parent.style("font-style").valueOrDefault(a.Font.Parse(a.ctx.font).fontStyle),f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=a.ToNumberArray(this.parent.attribute("dx").value),h=0;h<f.length;h++){var i=this.getGlyph(c,f,h),j=d/c.fontFace.unitsPerEm;b.translate(this.x,this.y),b.scale(j,-j);var k=b.lineWidth;b.lineWidth=b.lineWidth*c.fontFace.unitsPerEm/d,"italic"==e&&b.transform(1,0,.4,1,0,0),i.render(b),"italic"==e&&b.transform(1,0,-.4,1,0,0),b.lineWidth=k,b.scale(1/j,-1/j),b.translate(-this.x,-this.y),this.x+=d*(i.horizAdvX||c.horizAdvX)/c.fontFace.unitsPerEm,"undefined"==typeof g[h]||isNaN(g[h])||(this.x+=g[h])}}},this.getText=function(){},this.measureTextRecursive=function(a){for(var b=this.measureText(a),c=0;c<this.children.length;c++)b+=this.children[c].measureTextRecursive(a);return b},this.measureText=function(b){var c=this.parent.style("font-family").getDefinition();if(null!=c){var d=this.parent.style("font-size").numValueOrDefault(a.Font.Parse(a.ctx.font).fontSize),e=0,f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=a.ToNumberArray(this.parent.attribute("dx").value),h=0;h<f.length;h++){var i=this.getGlyph(c,f,h);e+=(i.horizAdvX||c.horizAdvX)*d/c.fontFace.unitsPerEm,"undefined"==typeof g[h]||isNaN(g[h])||(e+=g[h])}return e}var j=a.compressSpaces(this.getText());if(!b.measureText)return 10*j.length;b.save(),this.setContext(b);var k=b.measureText(j).width;return b.restore(),k}},a.Element.TextElementBase.prototype=new a.Element.RenderedElementBase,a.Element.tspan=function(b){this.captureTextNodes=!0,this.base=a.Element.TextElementBase,this.base(b),this.text=b.nodeValue||b.text||"",this.getText=function(){return this.text}},a.Element.tspan.prototype=new a.Element.TextElementBase,a.Element.tref=function(b){this.base=a.Element.TextElementBase,this.base(b),this.getText=function(){var a=this.getHrefAttribute().getDefinition();return null!=a?a.children[0].getText():void 0}},a.Element.tref.prototype=new a.Element.TextElementBase,a.Element.a=function(b){this.base=a.Element.TextElementBase,this.base(b),this.hasText=!0;for(var c=0;c<b.childNodes.length;c++)3!=b.childNodes[c].nodeType&&(this.hasText=!1);this.text=this.hasText?b.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(b){if(this.hasText){this.baseRenderChildren(b);var c=new a.Property("fontSize",a.Font.Parse(a.ctx.font).fontSize);a.Mouse.checkBoundingBox(this,new a.BoundingBox(this.x,this.y-c.toPixels("y"),this.x+this.measureText(b),this.y))}else{var d=new a.Element.g;d.children=this.children,d.parent=this,d.render(b)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){a.ctx.canvas.style.cursor="pointer"}},a.Element.a.prototype=new a.Element.TextElementBase,a.Element.image=function(b){this.base=a.Element.RenderedElementBase,this.base(b);var c=this.getHrefAttribute().value,d=c.match(/\.svg$/);if(a.Images.push(this),this.loaded=!1,d)this.img=a.ajax(c),this.loaded=!0;else{this.img=document.createElement("img");var e=this;this.img.onload=function(){e.loaded=!0},this.img.onerror=function(){"undefined"!=typeof console&&(console.log('ERROR: image "'+c+'" not found'),e.loaded=!0)},this.img.src=c}this.renderChildren=function(b){var c=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),f=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");0!=f&&0!=g&&(b.save(),d?b.drawSvg(this.img,c,e,f,g):(b.translate(c,e),a.AspectRatio(b,this.attribute("preserveAspectRatio").value,f,this.img.width,g,this.img.height,0,0),b.drawImage(this.img,0,0)),b.restore())},this.getBoundingBox=function(){var b=this.attribute("x").toPixels("x"),c=this.attribute("y").toPixels("y"),d=this.attribute("width").toPixels("x"),e=this.attribute("height").toPixels("y");return new a.BoundingBox(b,c,b+d,c+e)}},a.Element.image.prototype=new a.Element.RenderedElementBase,a.Element.g=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.getBoundingBox=function(){for(var b=new a.BoundingBox,c=0;c<this.children.length;c++)b.addBoundingBox(this.children[c].getBoundingBox());return b}},a.Element.g.prototype=new a.Element.RenderedElementBase,a.Element.symbol=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.baseSetContext=this.setContext,this.setContext=function(b){if(this.baseSetContext(b),this.attribute("viewBox").hasValue()){var c=a.ToNumberArray(this.attribute("viewBox").value),d=c[0],e=c[1];width=c[2],height=c[3],a.AspectRatio(b,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,d,e),a.ViewPort.SetCurrent(c[2],c[3])}}},a.Element.symbol.prototype=new a.Element.RenderedElementBase,a.Element.style=function(b){this.base=a.Element.ElementBase,this.base(b);for(var c="",d=0;d<b.childNodes.length;d++)c+=b.childNodes[d].nodeValue;c=c.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),c=a.compressSpaces(c);for(var e=c.split("}"),d=0;d<e.length;d++)if(""!=a.trim(e[d]))for(var f=e[d].split("{"),g=f[0].split(","),h=f[1].split(";"),i=0;i<g.length;i++){var j=a.trim(g[i]);if(""!=j){for(var k={},l=0;l<h.length;l++){var m=h[l].indexOf(":"),n=h[l].substr(0,m),o=h[l].substr(m+1,h[l].length-m);null!=n&&null!=o&&(k[a.trim(n)]=new a.Property(a.trim(n),a.trim(o)))}if(a.Styles[j]=k,"@font-face"==j)for(var p=k["font-family"].value.replace(/"/g,""),q=k.src.value.split(","),r=0;r<q.length;r++)if(q[r].indexOf('format("svg")')>0)for(var s=q[r].indexOf("url"),t=q[r].indexOf(")",s),u=q[r].substr(s+5,t-s-6),v=a.parseXml(a.ajax(u)),w=v.getElementsByTagName("font"),x=0;x<w.length;x++){var y=a.CreateElement(w[x]);a.Definitions[p]=y}}}},a.Element.style.prototype=new a.Element.ElementBase,a.Element.use=function(b){this.base=a.Element.RenderedElementBase,this.base(b),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.attribute("x").hasValue()&&a.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var a=this.getHrefAttribute().getDefinition();return this.attribute("width").hasValue()&&(a.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(a.attribute("height",!0).value=this.attribute("height").value),a},this.path=function(a){var b=this.getDefinition();null!=b&&b.path(a)},this.getBoundingBox=function(){var a=this.getDefinition();return null!=a?a.getBoundingBox():void 0},this.renderChildren=function(a){var b=this.getDefinition();if(null!=b){var c=b.parent;b.parent=null,b.render(a),b.parent=c}}},a.Element.use.prototype=new a.Element.RenderedElementBase,a.Element.mask=function(b){this.base=a.Element.ElementBase,this.base(b),this.apply=function(b,c){var d=this.attribute("x").toPixels("x"),e=this.attribute("y").toPixels("y"),f=this.attribute("width").toPixels("x"),g=this.attribute("height").toPixels("y");if(0==f&&0==g){for(var h=new a.BoundingBox,i=0;i<this.children.length;i++)h.addBoundingBox(this.children[i].getBoundingBox());var d=Math.floor(h.x1),e=Math.floor(h.y1),f=Math.floor(h.width()),g=Math.floor(h.height())}var j=c.attribute("mask").value;c.attribute("mask").value="";var k=document.createElement("canvas");k.width=d+f,k.height=e+g;var l=k.getContext("2d");this.renderChildren(l);var m=document.createElement("canvas");m.width=d+f,m.height=e+g;var n=m.getContext("2d");c.render(n),n.globalCompositeOperation="destination-in",n.fillStyle=l.createPattern(k,"no-repeat"),n.fillRect(0,0,d+f,e+g),b.fillStyle=n.createPattern(m,"no-repeat"),b.fillRect(0,0,d+f,e+g),c.attribute("mask").value=j},this.render=function(a){}},a.Element.mask.prototype=new a.Element.ElementBase,a.Element.clipPath=function(b){this.base=a.Element.ElementBase,this.base(b),this.apply=function(b){for(var c=0;c<this.children.length;c++){var d=this.children[c];if("undefined"!=typeof d.path){var e=null;d.attribute("transform").hasValue()&&(e=new a.Transform(d.attribute("transform").value),e.apply(b)),d.path(b),b.clip(),e&&e.unapply(b)}}},this.render=function(a){}},a.Element.clipPath.prototype=new a.Element.ElementBase,a.Element.filter=function(b){this.base=a.Element.ElementBase,this.base(b),this.apply=function(a,b){var c=b.getBoundingBox(),d=Math.floor(c.x1),e=Math.floor(c.y1),f=Math.floor(c.width()),g=Math.floor(c.height()),h=b.style("filter").value;b.style("filter").value="";for(var i=0,j=0,k=0;k<this.children.length;k++){var l=this.children[k].extraFilterDistance||0;i=Math.max(i,l),j=Math.max(j,l)}var m=document.createElement("canvas");m.width=f+2*i,m.height=g+2*j;var n=m.getContext("2d");n.translate(-d+i,-e+j),b.render(n);for(var k=0;k<this.children.length;k++)this.children[k].apply(n,0,0,f+2*i,g+2*j);a.drawImage(m,0,0,f+2*i,g+2*j,d-i,e-j,f+2*i,g+2*j),b.style("filter",!0).value=h},this.render=function(a){}},a.Element.filter.prototype=new a.Element.ElementBase,a.Element.feMorphology=function(b){this.base=a.Element.ElementBase,this.base(b),this.apply=function(a,b,c,d,e){}},a.Element.feMorphology.prototype=new a.Element.ElementBase,a.Element.feColorMatrix=function(b){function c(a,b,c,d,e,f){return a[c*d*4+4*b+f]}function d(a,b,c,d,e,f,g){a[c*d*4+4*b+f]=g}this.base=a.Element.ElementBase,this.base(b),this.apply=function(a,b,e,f,g){for(var h=a.getImageData(0,0,f,g),e=0;g>e;e++)for(var b=0;f>b;b++){var i=c(h.data,b,e,f,g,0),j=c(h.data,b,e,f,g,1),k=c(h.data,b,e,f,g,2),l=(i+j+k)/3;d(h.data,b,e,f,g,0,l),d(h.data,b,e,f,g,1,l),d(h.data,b,e,f,g,2,l)}a.clearRect(0,0,f,g),a.putImageData(h,0,0)}},a.Element.feColorMatrix.prototype=new a.Element.ElementBase,a.Element.feGaussianBlur=function(b){this.base=a.Element.ElementBase,this.base(b),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(b,d,e,f,g){return"undefined"==typeof c?void("undefined"!=typeof console&&console.log("ERROR: StackBlur.js must be included for blur to work")):(b.canvas.id=a.UniqueId(),b.canvas.style.display="none",document.body.appendChild(b.canvas),c(b.canvas.id,d,e,f,g,this.blurRadius),void document.body.removeChild(b.canvas))}},a.Element.feGaussianBlur.prototype=new a.Element.ElementBase,a.Element.title=function(a){},a.Element.title.prototype=new a.Element.ElementBase,a.Element.desc=function(a){},a.Element.desc.prototype=new a.Element.ElementBase,a.Element.MISSING=function(a){"undefined"!=typeof console&&console.log("ERROR: Element '"+a.nodeName+"' not yet implemented.")},a.Element.MISSING.prototype=new a.Element.ElementBase,a.CreateElement=function(b){var c=b.nodeName.replace(/^[^:]+:/,"");c=c.replace(/\-/g,"");var d=null;return d="undefined"!=typeof a.Element[c]?new a.Element[c](b):new a.Element.MISSING(b),d.type=b.nodeName,d},a.load=function(b,c){a.loadXml(b,a.ajax(c))},a.loadXml=function(b,c){a.loadXmlDoc(b,a.parseXml(c))},a.loadXmlDoc=function(b,c){a.init(b);var d=function(a){for(var c=b.canvas;c;)a.x-=c.offsetLeft,a.y-=c.offsetTop,c=c.offsetParent;return window.scrollX&&(a.x+=window.scrollX),window.scrollY&&(a.y+=window.scrollY),a};1!=a.opts.ignoreMouse&&(b.canvas.onclick=function(b){var c=d(new a.Point(null!=b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onclick(c.x,c.y)},b.canvas.onmousemove=function(b){var c=d(new a.Point(null!=b?b.clientX:event.clientX,null!=b?b.clientY:event.clientY));a.Mouse.onmousemove(c.x,c.y)});var e=a.CreateElement(c.documentElement);e.root=!0;var f=!0,g=function(){a.ViewPort.Clear(),b.canvas.parentNode&&a.ViewPort.SetCurrent(b.canvas.parentNode.clientWidth,b.canvas.parentNode.clientHeight),1!=a.opts.ignoreDimensions&&(e.style("width").hasValue()&&(b.canvas.width=e.style("width").toPixels("x"),b.canvas.style.width=b.canvas.width+"px"),e.style("height").hasValue()&&(b.canvas.height=e.style("height").toPixels("y"),b.canvas.style.height=b.canvas.height+"px"));var d=b.canvas.clientWidth||b.canvas.width,g=b.canvas.clientHeight||b.canvas.height;if(1==a.opts.ignoreDimensions&&e.style("width").hasValue()&&e.style("height").hasValue()&&(d=e.style("width").toPixels("x"),g=e.style("height").toPixels("y")),a.ViewPort.SetCurrent(d,g),null!=a.opts.offsetX&&(e.attribute("x",!0).value=a.opts.offsetX),null!=a.opts.offsetY&&(e.attribute("y",!0).value=a.opts.offsetY),null!=a.opts.scaleWidth&&null!=a.opts.scaleHeight){var h=1,i=1,j=a.ToNumberArray(e.attribute("viewBox").value);e.attribute("width").hasValue()?h=e.attribute("width").toPixels("x")/a.opts.scaleWidth:isNaN(j[2])||(h=j[2]/a.opts.scaleWidth),e.attribute("height").hasValue()?i=e.attribute("height").toPixels("y")/a.opts.scaleHeight:isNaN(j[3])||(i=j[3]/a.opts.scaleHeight),e.attribute("width",!0).value=a.opts.scaleWidth,e.attribute("height",!0).value=a.opts.scaleHeight,e.attribute("viewBox",!0).value="0 0 "+d*h+" "+g*i,e.attribute("preserveAspectRatio",!0).value="none"}1!=a.opts.ignoreClear&&b.clearRect(0,0,d,g),e.render(b),f&&(f=!1,"function"==typeof a.opts.renderCallback&&a.opts.renderCallback(c))},h=!0;a.ImagesLoaded()&&(h=!1,g()),a.intervalID=setInterval(function(){var b=!1;if(h&&a.ImagesLoaded()&&(h=!1,b=!0),1!=a.opts.ignoreMouse&&(b|=a.Mouse.hasEvents()),1!=a.opts.ignoreAnimation)for(var c=0;c<a.Animations.length;c++)b|=a.Animations[c].update(1e3/a.FRAMERATE);
"function"==typeof a.opts.forceRedraw&&1==a.opts.forceRedraw()&&(b=!0),b&&(g(),a.Mouse.runEvents())},1e3/a.FRAMERATE)},a.stop=function(){a.intervalID&&clearInterval(a.intervalID)},a.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(a,b){this.events.push({type:"onclick",x:a,y:b,run:function(a){a.onclick&&a.onclick()}})},this.onmousemove=function(a,b){this.events.push({type:"onmousemove",x:a,y:b,run:function(a){a.onmousemove&&a.onmousemove()}})},this.eventElements=[],this.checkPath=function(a,b){for(var c=0;c<this.events.length;c++){var d=this.events[c];b.isPointInPath&&b.isPointInPath(d.x,d.y)&&(this.eventElements[c]=a)}},this.checkBoundingBox=function(a,b){for(var c=0;c<this.events.length;c++){var d=this.events[c];b.isPointInBox(d.x,d.y)&&(this.eventElements[c]=a)}},this.runEvents=function(){a.ctx.canvas.style.cursor="";for(var b=0;b<this.events.length;b++)for(var c=this.events[b],d=this.eventElements[b];d;)c.run(d),d=d.parent;this.events=[],this.eventElements=[]}},a}this.canvg=function(b,c,d){if(null!=b||null!=c||null!=d){d=d||{},"string"==typeof b&&(b=document.getElementById(b)),null!=b.svg&&b.svg.stop();var e=a();(1!=b.childNodes.length||"OBJECT"!=b.childNodes[0].nodeName)&&(b.svg=e),e.opts=d;var f=b.getContext("2d");"undefined"!=typeof c.documentElement?e.loadXmlDoc(f,c):"<"==c.substr(0,1)?e.loadXml(f,c):e.load(f,c)}else for(var g=document.getElementsByTagName("svg"),h=0;h<g.length;h++){var i=g[h],j=document.createElement("canvas");j.width=i.clientWidth,j.height=i.clientHeight,i.parentNode.insertBefore(j,i),i.parentNode.removeChild(i);var k=document.createElement("div");k.appendChild(i),canvg(j,k.innerHTML)}}}(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(a,b,c,d,e){canvg(this.canvas,a,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:b,offsetY:c,scaleWidth:d,scaleHeight:e})}),canvg}},b[1]={value:function(a){function c(a,b,c){var f=a.container.getRenderBox();return d(a.node.ownerDocument,{width:f.width,height:f.height,content:e(a.node)},b,c)}function d(a,b,c,d){var e=arguments;g.apply(null,e)}function e(a){var b=a.ownerDocument.createElement("div"),c=['<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="',a.getAttribute("width"),'" height="',a.getAttribute("height"),'">'];return b.appendChild(a.cloneNode(!0)),b.innerHTML.replace(/<svg[^>]+?>/i,c.join("")).replace(/&nbsp;/g,"")}function f(a,b,c,d){var e=a.createElement("canvas"),f=e.getContext("2d");return e.width=b,e.height=c,"image/png"!==d&&(f.fillStyle="white",f.fillRect(0,0,e.width,e.height)),e}function g(a,b,c,d){var e=f(a,b.width,b.height,c);e.style.cssText="position: absolute; top: 0; left: 100000px; z-index: -1;",window.setTimeout(function(){a.body.appendChild(e),i(e,b.content),a.body.removeChild(e),d(e.toDataURL(c))},0)}var h=b.r(34),i=b.r(0);return h.createClass("Output",{constructor:function(a){this.formula=a},toJPG:function(a){c(this.formula,"image/jpeg",a)},toPNG:function(a){c(this.formula,"image/png",a)}})}},b[2]={value:function(){return["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","&#x237;","&#x131;","&#x3b1;","&#x3b2;","&#x3b3;","&#x3b4;","&#x3b5;","&#x3b6;","&#x3b7;","&#x3b8;","&#x3b9;","&#x3ba;","&#x3bb;","&#x3bc;","&#x3bd;","&#x3be;","&#x3bf;","&#x3c0;","&#x3c1;","&#x3c2;","&#x3c3;","&#x3c4;","&#x3c5;","&#x3c6;","&#x3c7;","&#x3c8;","&#x3c9;","&#x3d1;","&#x3d5;","&#x3d6;","&#x3de;","&#x3dc;","&#x3f5;","&#x3f1;","&#x3f9;","&#x211c;","&#x2135;","&#x2111;","&#x2127;","&#x2136;","&#x2137;","&#x2138;","&#xf0;","&#x210f;","&#x2141;","&#x210e;","&#x2202;","&#x2118;","&#x214c;","&#x2132;","&#x2201;","&#x2113;","&#x24c8;","(",")","&#x393;","&#x394;","&#x395;","&#x396;","&#x397;","&#x398;","&#x399;","&#x39a;","&#x39b;","&#x39c;","&#x39d;","&#x39e;","&#x39f;","&#x3a0;","&#x3a1;","&#x3a3;","&#x3a4;","&#x3a5;","&#x3a6;","&#x3a7;","&#x3a8;","&#x3a9;","&#x391;","&#x392;","#","!","$","%","&#x26;","&#x2220;","&#x2032;","&#x2035;","&#x2605;","&#x25c6;","&#x25a0;","&#x25b2;","&#x25bc;","&#x22a4;","&#x22a5;","&#x2663;","&#x2660;","&#x2662;","&#x2661;","&#x2203;","&#x2204;","&#x266d;","&#x266e;","&#x266f;","&#x2200;","&#x221e;","&#x2221;","&#x2207;","&#xac;","&#x2222;","&#x221a;","&#x25b3;","&#x25bd;","&#x2205;","&#xf8;","&#x25c7;","&#x25c0;","&#x25b8;","[","]","{","}","&#x3008;","&#x3009;","&#x3f0;",",",".","/",":",";","?","\\","&#x22ee;","&#x22ef;","&#x22f0;","&#x2026;","@","&#x22;","'","|","^","`","&#x201c;","_","*","+","-","&#x2210;","&#x22bc;","&#x22bb;","&#x25ef;","&#x22a1;","&#x229f;","&#x229e;","&#x22a0;","&#x2022;","&#x2229;","&#x222a;","&#x22d2;","&#x22d3;","&#x22d0;","&#x22d1;","&#xb7;","&#x25aa;","&#x25e6;","&#x229b;","&#x229a;","&#x2296;","&#x2299;","&#x229d;","&#x2295;","&#x2297;","&#x2298;","&#xb1;","&#x2213;","&#x22cf;","&#x22ce;","&#x2020;","&#x2021;","&#x22c4;","&#xf7;","&#x22c7;","&#x2214;","&#x232d;","&#x22d7;","&#x22d6;","&#x22c9;","&#x22ca;","&#x22cb;","&#x22cc;","&#x2293;","&#x2294;","&#x2291;","&#x2292;","&#x228f;","&#x2290;","&#x22c6;","&#xd7;","&#x22b3;","&#x22b2;","&#x22b5;","&#x22b4;","&#x228e;","&#x2228;","&#x2227;","&#x2240;","&#x3c;","=","&#x3e;","&#x2248;","&#x2247;","&#x224d;","&#x2252;","&#x2253;","&#x224a;","&#x223d;","&#x2241;","&#x2242;","&#x2243;","&#x22cd;","&#x224f;","&#x224e;","&#x2257;","&#x2245;","&#x22de;","&#x22df;","&#x2250;","&#x2251;","&#x2256;","&#x2a96;","&#x2a95;","&#x2261;","&#x2265;","&#x2264;","&#x2266;","&#x2267;","&#x2a7e;","&#x2a7d;","&#x226b;","&#x226a;","&#x2268;","&#x2269;","&#x22d8;","&#x22d9;","&#x2a87;","&#x2a88;","&#x2a89;","&#x2a8a;","&#x22e7;","&#x22e6;","&#x2a86;","&#x2a85;","&#x22db;","&#x22da;","&#x2a8b;","&#x2a8c;","&#x2277;","&#x2276;","&#x2273;","&#x2272;","&#x232e;","&#x232f;","&#x226f;","&#x2271;","&#x2270;","&#x226e;","&#x2331;","&#x2330;","&#x2332;","&#x2333;","&#x226c;","&#x2280;","&#x2281;","&#x22e0;","&#x22e1;","&#x227a;","&#x227b;","&#x227c;","&#x227d;","&#x227e;","&#x227f;","&#x2282;","&#x2283;","&#x2288;","&#x2289;","&#x2286;","&#x2287;","&#x228a;","&#x228b;","&#x2ab7;","&#x2ab8;","&#x2aaf;","&#x2ab0;","&#x2ab9;","&#x2aba;","&#x2ab5;","&#x2ab6;","&#x22e8;","&#x22e9;","&#x223c;","&#x225c;","&#x21b6;","&#x21b7;","&#x21ba;","&#x21bb;","&#x21be;","&#x21bf;","&#x21c2;","&#x21c3;","&#x21c4;","&#x21c6;","&#x21c8;","&#x21ca;","&#x21cb;","&#x21cc;","&#x21cd;","&#x21ce;","&#x21cf;","&#x21d0;","&#x21d1;","&#x21d2;","&#x21d3;","&#x21d4;","&#x21d5;","&#x21da;","&#x21db;","&#x21dd;","&#x21ab;","&#x21ac;","&#x21ad;","&#x21ae;","&#x2190;","&#x2191;","&#x2192;","&#x2193;","&#x2194;","&#x2195;","&#x2196;","&#x2197;","&#x2198;","&#x2199;","&#x219e;","&#x21a0;","&#x21a2;","&#x21a3;","&#x21b0;","&#x21b1;","&#x22a2;","&#x22a3;","&#x22a8;","&#x22a9;","&#x22aa;","&#x22ad;","&#x22af;","&#x22b8;","&#x22ba;","&#x22d4;","&#x22ea;","&#x22eb;","&#x22ec;","&#x22ed;","&#x2308;","&#x2309;","&#x230a;","&#x230b;","&#x2acb;","&#x2acc;","&#x2ac5;","&#x2ac6;","&#x2208;","&#x220b;","&#x221d;","&#x2224;","&#x2226;","&#x2234;","&#x2235;","&#x220d;","&#x22c8;","&#x2322;","&#x2323;","&#x2223;","&#x2225;","&#x23d0;","&#x23d1;","&#x23d2;","&#x23d3;","&#x2ac7;","&#x2ac8;","&#x22ae;","&#x22ac;","&#x2ac9;","&#x23d4;","&#x23d5;","&#x23d6;","&#x23d7;","&#x21c7;","&#x21c9;","&#x21bc;","&#x21bd;","&#x21c0;","&#x21c1;","&#x219a;","&#x219b;","&#x27f5;","&#x27f6;","&#x27f7;","&#x27f9;","&#x27f8;","&#x27fa;","&#x2262;","&#x2260;","&#x2209;"]}},b[3]={value:function(){return{defaultFont:"KF AMS MAIN"}}},b[4]={value:function(a){function c(a){var b=new e.Text;return"innerHTML"in b.node?b.node.setAttributeNS(g,"xml:space","preserve"):-1!=a.indexOf(" ")&&(a=d(a)),b.setContent(a),b}function d(a){return f.innerHTML='<svg><text gg="asfdas">'+a.replace(/\s/gi,"&nbsp;")+"</text></svg>",f.firstChild.firstChild.textContent}var e=b.r(34),f=document.createElement("div"),g="http://www.w3.org/XML/1998/namespace";return{create:function(a){return c(a)}}}},b[5]={value:function(a){var c=b.r(34),d=b.r(47).font,e=b.r(25),f=b.r(4);return c.createClass("Text",{base:b.r(46),constructor:function(a,b){this.callBase(),this.fontFamily=b,this.fontSize=50,this.content=a||"",this.box.remove(),this.translationContent=this.translation(this.content),this.contentShape=new c.Group,this.contentNode=this.createContent(),this.contentShape.addShape(this.contentNode),this.addShape(this.contentShape)},createContent:function(){var a=f.create(this.translationContent);return a.setAttr({"font-family":this.fontFamily,"font-size":50,x:0,y:d.offset}),a},setFamily:function(a){this.fontFamily=a,this.contentNode.setAttr("font-family",a)},setFontSize:function(a){this.fontSize=a,this.contentNode.setAttr("font-size",a+"px"),this.contentNode.setAttr("y",a/50*d.offset)},getBaseHeight:function(){for(var a=this.contentShape.getItems(),b=null,c=0,d=0;b=a[c];)d=Math.max(d,b.getHeight()),c++;return d},translation:function(a){var b=this.fontFamily;return a.replace(/``/g,"\u201c").replace(/\\([a-zA-Z,]+)\\/g,function(a,c){if(","===c)return" ";var d=e.getCharacterValue(c,b);return d?d:""})}})}},b[6]={value:function(){return{UNKNOWN:-1,EXP:0,COMPOUND_EXP:1,OP:2}}},b[7]={value:function(){return{SIDE:"side",FOLLOW:"follow"}}},b[8]={value:function(a){var c=b.r(34);return c.createClass("SubscriptExpression",{base:b.r(17),constructor:function(a,b){this.callBase(a,null,b),this.setFlag("Subscript")}})}},b[9]={value:function(a){var c=b.r(34);return c.createClass("SuperscriptExpression",{base:b.r(17),constructor:function(a,b){this.callBase(a,b,null),this.setFlag("Superscript")}})}},b[10]={value:function(a){var c=b.r(34);return c.createClass("BinaryExpression",{base:b.r(19),constructor:function(a,b){this.callBase(),this.setFirstOperand(a),this.setLastOperand(b)},setFirstOperand:function(a){return this.setOperand(a,0)},getFirstOperand:function(){return this.getOperand(0)},setLastOperand:function(a){return this.setOperand(a,1)},getLastOperand:function(){return this.getOperand(1)}})}},b[11]={value:function(a){var c=b.r(34),d=b.r(35);return c.createClass("BracketsExpression",{base:b.r(19),constructor:function(a,b,c){this.callBase(),this.setFlag("Brackets"),2===arguments.length&&(c=b,b=a),this.leftSymbol=a,this.rightSymbol=b,this.setOperator(new d),this.setOperand(c,0)},getLeftSymbol:function(){return this.leftSymbol},getRightSymbol:function(){return this.rightSymbol}})}},b[12]={value:function(a){var c=b.r(34),d=b.r(47).font,e=b.r(36);return c.createClass("CombinationExpression",{base:b.r(19),constructor:function(){this.callBase(),this.setFlag("Combination"),this.setOperator(new e),c.Utils.each(arguments,function(a,b){this.setOperand(a,b)},this)},getRenderBox:function(a){var b=this.callBase(a);return 0===this.getOperands().length&&(b.height=d.spaceHeight),b},getBaseline:function(a){var b=0,d=this.getOperands();return 0===d.length?this.callBase(a):(c.Utils.each(d,function(c){b=Math.max(c.getBaseline(a),b)}),b)},getMeanline:function(a){var b=1e7,d=this.getOperands();return 0===d.length?this.callBase(a):(c.Utils.each(d,function(c){b=Math.min(c.getMeanline(a),b)}),b)}})}},b[13]={value:function(a){var c=b.r(34),d=b.r(38);return c.createClass("FractionExpression",{base:b.r(10),constructor:function(a,b){this.callBase(a,b),this.setFlag("Fraction"),this.setOperator(new d)},getBaseline:function(a){var b=this.getOperand(1),c=b.getRenderBox(a);return c.y+b.getBaselineProportion()*c.height},getMeanline:function(a){var b=this.getOperand(0),c=b.getRenderBox(a);return b.getMeanlineProportion()*c.height}})}},b[14]={value:function(a){var c=b.r(34),d=b.r(47).func,e=b.r(39);return c.createClass("FunctionExpression",{base:b.r(19),constructor:function(a,b,c,d){this.callBase(),this.setFlag("Func"),this.funcName=a,this.setOperator(new e(a)),this.setExpr(b),this.setSuperscript(c),this.setSubscript(d)},isSideScript:function(){return!d["ud-script"][this.funcName]},setExpr:function(a){return this.setOperand(a,0)},setSuperscript:function(a){return this.setOperand(a,1)},setSubscript:function(a){return this.setOperand(a,2)}})}},b[15]={value:function(a){var c=b.r(34),d=b.r(40),e=c.createClass("IntegrationExpression",{base:b.r(19),constructor:function(a,b,c){this.callBase(),this.setFlag("Integration"),this.setOperator(new d),this.setIntegrand(a),this.setSuperscript(b),this.setSubscript(c)},setType:function(a){return this.getOperator().setType(a),this},resetType:function(){return this.getOperator().resetType(),this},setIntegrand:function(a){this.setOperand(a,0)},setSuperscript:function(a){this.setOperand(a,1)},setSubscript:function(a){this.setOperand(a,2)}});return e}},b[16]={value:function(a){var c=b.r(34),d=b.r(42);return c.createClass("RadicalExpression",{base:b.r(10),constructor:function(a,b){this.callBase(a,b),this.setFlag("Radicand"),this.setOperator(new d)},setRadicand:function(a){return this.setFirstOperand(a)},getRadicand:function(){return this.getFirstOperand()},setExponent:function(a){return this.setLastOperand(a)},getExponent:function(){return this.getLastOperand()}})}},b[17]={value:function(a){var c=b.r(34),d=b.r(43);return c.createClass("ScriptExpression",{base:b.r(19),constructor:function(a,b,c){this.callBase(),this.setFlag("Script"),this.setOperator(new d),this.setOpd(a),this.setSuperscript(b),this.setSubscript(c)},setOpd:function(a){this.setOperand(a,0)},setSuperscript:function(a){this.setOperand(a,1)},setSubscript:function(a){this.setOperand(a,2)}})}},b[18]={value:function(a){var c=b.r(34),d=b.r(44);return c.createClass("SummationExpression",{base:b.r(19),constructor:function(a,b,c){this.callBase(),this.setFlag("Summation"),this.setOperator(new d),this.setExpr(a),this.setSuperscript(b),this.setSubscript(c)},setExpr:function(a){this.setOperand(a,0)},setSuperscript:function(a){this.setOperand(a,1)},setSubscript:function(a){this.setOperand(a,2)}})}},b[19]={value:function(a){var c=b.r(34),d=b.r(6),e=b.r(21);return c.createClass("CompoundExpression",{base:b.r(21),constructor:function(){this.callBase(),this.type=d.COMPOUND_EXP,this.operands=[],this.operator=null,this.operatorBox=new c.Group,this.operatorBox.setAttr("data-type","kf-editor-exp-op-box"),this.operandBox=new c.Group,this.operandBox.setAttr("data-type","kf-editor-exp-operand-box"),this.setChildren(0,this.operatorBox),this.setChildren(1,this.operandBox)},setOperator:function(a){return void 0===a?this:(this.operator&&this.operator.remove(),this.operatorBox.addShape(a),this.operator=a,this.operator.setParentExpression(this),a.expression=this,this)},getOperator:function(){return this.operator},setOperand:function(a,b,c){return c===!1?(this.operands[b]=a,this):(a=e.wrap(a),this.operands[b]&&this.operands[b].remove(),this.operands[b]=a,this.operandBox.addShape(a),this)},getOperand:function(a){return this.operands[a]},getOperands:function(){return this.operands},addedCall:function(){return this.operator.applyOperand.apply(this.operator,this.operands),this}})}},b[20]={value:function(a){var c=b.r(34),d=b.r(47).font,e=b.r(21),f=c.createClass("EmptyExpression",{base:e,constructor:function(){this.callBase(),this.setFlag("Empty")},getRenderBox:function(){return{width:0,height:d.spaceHeight,x:0,y:0}}});return f.isEmpty=function(a){return a instanceof f},e.registerWrap("empty",function(a){return null===a||void 0===a?new f:void 0}),f}},b[21]={value:function(a){var c=b.r(34),d=b.r(6),e=b.r(47).font,f=[],g={},h=c.createClass("Expression",{base:b.r(46),constructor:function(){this.callBase(),this.type=d.EXP,this._offset={top:0,bottom:0},this.children=[],this.box.fill("transparent").setAttr("data-type","kf-editor-exp-box"),this.box.setAttr("data-type","kf-editor-exp-bg-box"),this.expContent=new c.Group,this.expContent.setAttr("data-type","kf-editor-exp-content-box"),this.addShape(this.expContent)},getChildren:function(){return this.children},getChild:function(a){return this.children[a]||null},getTopOffset:function(){return this._offset.top},getBottomOffset:function(){return this._offset.bottom},getOffset:function(){return this._offset},setTopOffset:function(a){this._offset.top=a},setBottomOffset:function(a){this._offset.bottom=a},setOffset:function(a,b){this._offset.top=a,this._offset.bottom=b},setFlag:function(a){this.setAttr("data-flag",a||"Expression")},setChildren:function(a,b){this.children[a]&&this.children[a].remove(),this.children[a]=b,this.expContent.addShape(b)},getBaselineProportion:function(){return e.baselinePosition},getMeanlineProportion:function(){return e.meanlinePosition},getBaseline:function(a){return this.getRenderBox(a).height*e.baselinePosition-3},getMeanline:function(a){return this.getRenderBox(a).height*e.meanlinePosition-1},getAscenderline:function(){return this.getFixRenderBox().height*e.ascenderPosition},getDescenderline:function(){return this.getFixRenderBox().height*e.descenderPosition},translateElement:function(a,b){this.expContent.translate(a,b)},expand:function(a,b){var c=this.getFixRenderBox();this.setBoxSize(c.width+a,c.height+b)},getBaseWidth:function(){return this.getWidth()},getBaseHeight:function(){return this.getHeight()},updateBoxSize:function(){var a=this.expContent.getFixRenderBox();this.setBoxSize(a.width,a.height)},getBox:function(){return this.box}});return c.Utils.extend(h,{registerWrap:function(a,b){g[a]=f.length,f.push(b)},revokeWrap:function(a){var b=null;return a in g&&(b=f[g[a]],f[g[a]]=null,delete g[a]),b},wrap:function(a){var b;return c.Utils.each(f,function(c){return c?(b=c(a),b?!1:void 0):void 0}),b}}),h}},b[22]={value:function(a){var c=b.r(5),d=b.r(34),e=b.r(3),f=b.r(21),g=d.createClass("TextExpression",{base:b.r(21),constructor:function(a,b){this.callBase(),this.fontFamily=b||e.defaultFont,this.setFlag("Text"),this.content=a+"",this.textContent=new c(this.content,this.fontFamily),this.setChildren(0,this.textContent),this.setChildren(1,new d.Rect(0,0,0,0).fill("transparent"))},setFamily:function(a){this.textContent.setFamily(a)},setFontSize:function(a){this.textContent.setFontSize(a)},addedCall:function(){var a=this.textContent.getFixRenderBox();return this.getChild(1).setSize(a.width,a.height),this.updateBoxSize(),this}});return f.registerWrap("text",function(a){var b=typeof a;return("number"===b||"string"===b)&&(a=new g(a)),a}),g}},b[23]={value:function(){return['<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<text id="abcd" font-family="KF AMS MAIN" font-size="50" x="0" y="0">x</text>',"</svg>"]}},b[24]={value:function(a){function c(a,b,c){j.get(b.meta.src,function(d,f){"success"===f&&e(a,b),c()})}function d(a,b){window.setTimeout(function(){f(a),g(),b()},100)}function e(a,b){var c=document.createElement("div"),d=b.meta.fontFamily;c.style.cssText="position: absolute; top: -10000px; left: -100000px;",c.style.fontFamily=d,c.innerHTML=l.join(""),a.body.appendChild(c),m.push(c)}function f(a){var c=a.createElement("div");c.style.cssText="position: absolute; top: 0; left: -100000px;",c.innerHTML=b.r(23).join(""),a.body.appendChild(c);var d=c.getElementsByTagName("text")[0].getBBox();k.spaceHeight=d.height,k.topSpace=-d.y-k.baseline,k.bottomSpace=k.spaceHeight-k.topSpace-k.baseHeight,k.offset=k.baseline+k.topSpace,k.baselinePosition=(k.topSpace+k.baseline)/k.spaceHeight,k.meanlinePosition=(k.topSpace+k.meanline)/k.spaceHeight,k.ascenderPosition=k.topSpace/k.spaceHeight,k.descenderPosition=(k.topSpace+k.baseHeight)/k.spaceHeight,a.body.removeChild(c)}function g(){h.Utils.each(m,function(a){a.parentNode.removeChild(a)}),m=[]}var h=b.r(34),i=b.r(25),j=b.r(33),k=b.r(47).font,l=b.r(2),m=[];return h.createClass("FontInstaller",{constructor:function(a,b){this.callBase(),this.resource=b||"../src/resource/",this.doc=a},mount:function(a){var b=i.getFontList(),e=0,f=this;h.Utils.each(b,function(b){e++,b.meta.src=f.resource+b.meta.src,f.createFontStyle(b),c(f.doc,b,function(){e--,0===e&&d(f.doc,a)})})},createFontStyle:function(a){var b=this.doc.createElement("style"),c='@font-face{\nfont-family: "${fontFamily}";\nsrc: url("${src}");\n}';b.setAttribute("type","text/css"),b.innerHTML=c.replace("${fontFamily}",a.meta.fontFamily).replace("${src}",a.meta.src),this.doc.head.appendChild(b)}})}},b[25]={value:function(a){var c={},d=b.r(34),e=b.r(47).font.list;return function(){d.Utils.each(e,function(a){c[a.meta.fontFamily]=a})}(),{getFontList:function(){return c},getCharacterValue:function(a,b){return c[b]?c[b].map[a]||null:null}}}},b[26]={value:function(){return{meta:{fontFamily:"KF AMS BB",src:"KF_AMS_BB.woff"}}}},b[27]={value:function(){return{meta:{fontFamily:"KF AMS CAL",src:"KF_AMS_CAL.woff"}}}},b[28]={value:function(){return{meta:{fontFamily:"KF AMS FRAK",src:"KF_AMS_FRAK.woff"}}}},b[29]={value:function(){return{meta:{fontFamily:"KF AMS MAIN",src:"KF_AMS_MAIN.woff"},map:{Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9",alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",varkappa:"\u03f0",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",digamma:"\u03dc",varepsilon:"\u03f5",varrho:"\u03f1",varphi:"\u03d5",vartheta:"\u03d1",varpi:"\u03d6",varsigma:"\u03f9",aleph:"\u2135",beth:"\u2136",daleth:"\u2138",gimel:"\u2137",eth:"\xf0",hbar:"\u210e",hslash:"\u210f",mho:"\u2127",partial:"\u2202",wp:"\u2118",Game:"\u2141",Bbbk:"\u214c",Finv:"\u2132",Im:"\u2111",Re:"\u211c",complement:"\u2201",ell:"\u2113",circledS:"\u24c8",imath:"\u0131",jmath:"\u0237",doublecap:"\u22d2",Cap:"\u22d2",doublecup:"\u22d3",Cup:"\u22d3",ast:"*",divideontimes:"\u22c7",rightthreetimes:"\u22cc",leftthreetimes:"\u22cb",cdot:"\xb7",odot:"\u2299",dotplus:"\u2214",rtimes:"\u22ca",ltimes:"\u22c9",centerdot:"\u25aa",doublebarwedge:"\u232d",setminus:"\u2481",amalg:"\u2210",circ:"\u25e6",bigcirc:"\u25ef",gtrdot:"\u22d7",lessdot:"\u22d6",smallsetminus:"\u2485",circledast:"\u229b",circledcirc:"\u229a",sqcap:"\u2293",sqcup:"\u2294",barwedge:"\u22bc",circleddash:"\u229d",star:"\u22c6",bigtriangledown:"\u25bd",bigtriangleup:"\u25b3",cup:"\u222a",cap:"\u2229",times:"\xd7",mp:"\u2213",pm:"\xb1",triangleleft:"\u22b2",triangleright:"\u22b3",boxdot:"\u22a1",curlyvee:"\u22cf",curlywedge:"\u22ce",boxminus:"\u229f",boxtimes:"\u22a0",ominus:"\u2296",oplus:"\u2295",oslash:"\u2298",otimes:"\u2297",uplus:"\u228e",boxplus:"\u229e",dagger:"\u2020",ddagger:"\u2021",vee:"\u2228",lor:"\u2228",veebar:"\u22bb",bullet:"\u2022",diamond:"\u22c4",wedge:"\u2227",land:"\u2227",div:"\xf7",wr:"\u2240",geqq:"\u2267",lll:"\u22d8",llless:"\u22d8",ggg:"\u22d9",gggtr:"\u22d9",preccurlyeq:"\u227c",geqslant:"\u2a7e",lnapprox:"\u2a89",preceq:"\u2aaf",gg:"\u226b",lneq:"\u2a87",precnapprox:"\u2ab9",approx:"\u2248",lneqq:"\u2268",precneqq:"\u2ab5",approxeq:"\u224a",gnapprox:"\u2a8a",lnsim:"\u22e6",precnsim:"\u22e8",asymp:"\u224d",gneq:"\u2a88",lvertneqq:"\u232e",precsim:"\u227e",backsim:"\u223d",gneqq:"\u2269",ncong:"\u2247",risingdotseq:"\u2253",backsimeq:"\u22cd",gnsim:"\u22e7",sim:"\u223c",simeq:"\u2243",bumpeq:"\u224f",gtrapprox:"\u2a86",ngeq:"\u2271",Bumpeq:"\u224e",gtreqless:"\u22db",ngeqq:"\u2331",succ:"\u227b",circeq:"\u2257",gtreqqless:"\u2a8c",ngeqslant:"\u2333",succapprox:"\u2ab8",cong:"\u2245",gtrless:"\u2277",ngtr:"\u226f",succcurlyeq:"\u227d",curlyeqprec:"\u22de",gtrsim:"\u2273",nleq:"\u2270",succeq:"\u2ab0",curlyeqsucc:"\u22df",gvertneqq:"\u232f",neq:"\u2260",ne:"\u2260",nequiv:"\u2262",nleqq:"\u2330",succnapprox:"\u2aba",doteq:"\u2250",leq:"\u2264",le:"\u2264",nleqslant:"\u2332",succneqq:"\u2ab6",doteqdot:"\u2251",Doteq:"\u2251",leqq:"\u2266",nless:"\u226e",succnsim:"\u22e9",leqslant:"\u2a7d",nprec:"\u2280",succsim:"\u227f",eqsim:"\u2242",lessapprox:"\u2a85",npreceq:"\u22e0",eqslantgtr:"\u2a96",lesseqgtr:"\u22da",nsim:"\u2241",eqslantless:"\u2a95",lesseqqgtr:"\u2a8b",nsucc:"\u2281",triangleq:"\u225c",eqcirc:"\u2256",equiv:"\u2261",lessgtr:"\u2276",nsucceq:"\u22e1",fallingdotseq:"\u2252",lesssim:"\u2272",prec:"\u227a",geq:"\u2265",ge:"\u2265",ll:"\u226a",precapprox:"\u2ab7",uparrow:"\u2191",downarrow:"\u2193",updownarrow:"\u2195",Uparrow:"\u21d1",Downarrow:"\u21d3",Updownarrow:"\u21d5",circlearrowleft:"\u21ba",circlearrowright:"\u21bb",curvearrowleft:"\u21b6",curvearrowright:"\u21b7",downdownarrows:"\u21ca",downharpoonleft:"\u21c3",downharpoonright:"\u21c2",leftarrow:"\u2190",gets:"\u2190",Leftarrow:"\u21d0",leftarrowtail:"\u21a2",leftharpoondown:"\u21bd",leftharpoonup:"\u21bc",leftleftarrows:"\u21c7",leftrightarrow:"\u2194",Leftrightarrow:"\u21d4",leftrightarrows:"\u21c4",leftrightharpoons:"\u21cb",leftrightsquigarrow:"\u21ad",Lleftarrow:"\u21da",looparrowleft:"\u21ab",looparrowright:"\u21ac",multimap:"\u22b8",nLeftarrow:"\u21cd",nRightarrow:"\u21cf",nLeftrightarrow:"\u21ce",nearrow:"\u2197",nleftarrow:"\u219a",nleftrightarrow:"\u21ae",nrightarrow:"\u219b",nwarrow:"\u2196",rightarrow:"\u2192",to:"\u2192",Rightarrow:"\u21d2",rightarrowtail:"\u21a3",rightharpoondown:"\u21c1",rightharpoonup:"\u21c0",rightleftarrows:"\u21c6",rightleftharpoons:"\u21cc",rightrightarrows:"\u21c9",rightsquigarrow:"\u21dd",Rrightarrow:"\u21db",searrow:"\u2198",swarrow:"\u2199",twoheadleftarrow:"\u219e",twoheadrightarrow:"\u21a0",upharpoonleft:"\u21bf",upharpoonright:"\u21be",restriction:"\u21be",upuparrows:"\u21c8",Lsh:"\u21b0",Rsh:"\u21b1",longleftarrow:"\u27f5",longrightarrow:"\u27f6",Longleftarrow:"\u27f8",Longrightarrow:"\u27f9",implies:"\u27f9",longleftrightarrow:"\u27f7",Longleftrightarrow:"\u27fa",backepsilon:"\u220d",because:"\u2235",therefore:"\u2234",between:"\u226c",blacktriangleleft:"\u25c0",blacktriangleright:"\u25b8",dashv:"\u22a3",bowtie:"\u22c8",frown:"\u2322","in":"\u2208",notin:"\u2209",mid:"\u2223",parallel:"\u2225",models:"\u22a8",ni:"\u220b",owns:"\u220b",nmid:"\u2224",nparallel:"\u2226",nshortmid:"\u23d2",nshortparallel:"\u23d3",nsubseteq:"\u2288",nsubseteqq:"\u2ac7",nsupseteq:"\u2289",nsupseteqq:"\u2ac8",ntriangleleft:"\u22ea",ntrianglelefteq:"\u22ec",ntriangleright:"\u22eb",ntrianglerighteq:"\u22ed",nvdash:"\u22ac",nVdash:"\u22ae",nvDash:"\u22ad",nVDash:"\u22af",perp:"\u22a5",pitchfork:"\u22d4",propto:"\u221d",shortmid:"\u23d0",shortparallel:"\u23d1",smile:"\u2323",sqsubset:"\u228f",sqsubseteq:"\u2291",sqsupset:"\u2290",sqsupseteq:"\u2292",subset:"\u2282",Subset:"\u22d0",subseteq:"\u2286",subseteqq:"\u2ac5",subsetneq:"\u228a",subsetneqq:"\u2acb",supset:"\u2283",Supset:"\u22d1",supseteq:"\u2287",supseteqq:"\u2ac6",supsetneq:"\u228b",supsetneqq:"\u2acc",trianglelefteq:"\u22b4",trianglerighteq:"\u22b5",varpropto:"\u2ac9",varsubsetneq:"\u23d4",varsubsetneqq:"\u23d6",varsupsetneq:"\u23d5",varsupsetneqq:"\u23d7",vdash:"\u22a2",Vdash:"\u22a9",vDash:"\u22a8",Vvdash:"\u22aa",vert:"|",Vert:"\u01c1","|":"\u01c1","{":"{","}":"}",backslash:"\\",langle:"\u3008",rangle:"\u3009",lceil:"\u2308",rceil:"\u2309",lbrace:"{",rbrace:"}",lfloor:"\u230a",rfloor:"\u230b",cdots:"\u22ef",ddots:"\u22f0",vdots:"\u22ee",dots:"\u2026",ldots:"\u2026","#":"#",bot:"\u22a5",angle:"\u2220",backprime:"\u2035",bigstar:"\u2605",blacklozenge:"\u25c6",blacksquare:"\u25a0",blacktriangle:"\u25b2",blacktriangledown:"\u25bc",clubsuit:"\u2663",diagdown:"\u2481",diagup:"\u2482",diamondsuit:"\u2662",emptyset:"\xf8",exists:"\u2203",flat:"\u266d",forall:"\u2200",heartsuit:"\u2661",infty:"\u221e",lozenge:"\u25c7",measuredangle:"\u2221",nabla:"\u2207",natural:"\u266e",neg:"\xac",lnot:"\xac",nexists:"\u2204",prime:"\u2032",sharp:"\u266f",spadesuit:"\u2660",sphericalangle:"\u2222",surd:"\u221a",top:"\u22a4",varnothing:"\u2205",triangle:"\u25b3",triangledown:"\u25bd",colon:":",degree:"\xb0"}}}},b[30]={value:function(){return{meta:{fontFamily:"KF AMS ROMAN",src:"KF_AMS_ROMAN.woff"}}}},b[31]={value:function(a){function c(){var a=0;return e.Utils.each(this.expressions,function(b){var c=null;b&&(b.setMatrix(new e.Matrix(1,0,0,1,0,0)),c=b.getFixRenderBox(),b.translate(0-c.x,a),a+=c.height+k)}),this}function d(a){var b=0;if(a){if(a.getType()===f.EXP)for(var c=0,b=a.getChildren().length;b>c;c++)d(a.getChild(c));else if(a.getType()===f.COMPOUND_EXP){for(var c=0,b=a.getOperands().length;b>c;c++)d(a.getOperand(c));d(a.getOperator())}a.addedCall&&a.addedCall()}}var e=b.r(34),f=b.r(6),g=b.r(25),h=b.r(24),i={fontsize:50,autoresize:!0,padding:[0]},j=b.r(1),k=10,l=e.createClass("ExpressionWrap",{constructor:function(a,b){this.wrap=new e.Group,this.bg=new e.Rect(0,0,0,0).fill("transparent"),this.exp=a,this.config=b,this.wrap.setAttr("data-type","kf-exp-wrap"),this.bg.setAttr("data-type","kf-exp-wrap-bg"),this.wrap.addShape(this.bg),this.wrap.addShape(this.exp)},getWrapShape:function(){return this.wrap},getExpression:function(){return this.exp},getBackground:function(){return this.bg},resize:function(){var a=this.config.padding,b=this.exp.getFixRenderBox();1===a.length&&(a[1]=a[0]),this.bg.setSize(2*a[1]+b.width,2*a[0]+b.height),this.exp.translate(a[1],a[0])}}),m=e.createClass("Formula",{base:b.r(32),constructor:function(a,b){this.callBase(a),this.expressions=[],this.fontInstaller=new h(this),this.config=e.Utils.extend({},i,b),this.initEnvironment(),this.initInnerFont()},getContentContainer:function(){return this.container},initEnvironment:function(){this.zoom=this.config.fontsize/50,"width"in this.config&&this.setWidth(this.config.width),"height"in this.config&&this.setHeight(this.config.height),this.node.setAttribute("font-size",i.fontsize)},initInnerFont:function(){function a(a){var b=c.doc.createElement("style"),d='@font-face{font-family: "${fontFamily}";font-style: normal;src: url("${src}") format("woff");}';b.setAttribute("type","text/css"),b.innerHTML=d.replace("${fontFamily}",a.meta.fontFamily).replace("${src}",a.meta.src),c.resourceNode.appendChild(b)}var b=g.getFontList(),c=this;e.Utils.each(b,function(b){a(b)})},insertExpression:function(a,b){var e=this.wrap(a);this.container.clearTransform(),this.expressions.splice(b,0,e.getWrapShape()),this.addShape(e.getWrapShape()),d.call(this,e.getExpression()),e.resize(),c.call(this),this.resetZoom(),this.config.autoresize&&this.resize()},appendExpression:function(a){this.insertExpression(a,this.expressions.length)},resize:function(){var a=this.container.getRenderBox("paper");this.node.setAttribute("width",a.width),this.node.setAttribute("height",a.height)},resetZoom:function(){var a=this.zoom/this.getBaseZoom();0!==a&&this.container.scale(a)},wrap:function(a){return new l(a,this.config)},clear:function(){this.callBase(),this.expressions=[]},clearExpressions:function(){e.Utils.each(this.expressions,function(a){a.remove()}),this.expressions=[]},toJPG:function(a){new j(this).toJPG(a)},toPNG:function(a){new j(this).toPNG(a)}});return e.Utils.extend(m,{registerFont:function(a){g.registerFont(a)}}),m}},b[32]={value:function(a){var c=b.r(34);return c.createClass("FPaper",{base:c.Paper,constructor:function(a){this.callBase(a),this.doc=a.ownerDocument,this.container=new c.Group,this.container.setAttr("data-type","kf-container"),this.background=new c.Group,this.background.setAttr("data-type","kf-bg"),this.baseZoom=1,this.zoom=1,this.base("addShape",this.background),this.base("addShape",this.container)},getZoom:function(){return this.zoom},getBaseZoom:function(){return this.baseZoom},addShape:function(a,b){return this.container.addShape(a,b)},getBackground:function(){return this.background},removeShape:function(a){return this.container.removeShape(a)},clear:function(){return this.container.clear()}})}},b[33]={value:function(){if(!window.jQuery)throw new Error("Missing jQuery");return window.jQuery}},b[34]={value:function(){if(!window.kity)throw new Error("Missing Kity Graphic Lib");return window.kity;
}},b[35]={value:function(a){function c(a){var b=this.getParentExpression().getLeftSymbol(),c=this.getParentExpression().getRightSymbol(),f=a.getFixRenderBox().height,g=new d.Group,h=0,i=new e(b,"KF AMS MAIN").fill("black"),j=new e(c,"KF AMS MAIN").fill("black");i.setFontSize(f),j.setFontSize(f),this.addOperatorShape(g.addShape(i).addShape(j)),h+=i.getFixRenderBox().width,a.translate(h,0),h+=a.getFixRenderBox().width,j.translate(h,0)}var d=b.r(34),e=b.r(5);return d.createClass("BracketsOperator",{base:b.r(41),constructor:function(){this.callBase("Brackets")},applyOperand:function(a){c.call(this,a)}})}},b[36]={value:function(a){var c=b.r(34);return c.createClass("CombinationOperator",{base:b.r(41),constructor:function(){this.callBase("Combination")},applyOperand:function(){var a=0,b=arguments,d=0,e=0,f=0,g=[],h=[];c.Utils.each(b,function(a){var b=a.getFixRenderBox(),c=a.getOffset();b.height-=c.top+c.bottom,g.push(b),h.push(c),e=Math.max(c.top,e),f=Math.max(c.bottom,f),d=Math.max(b.height,d)}),c.Utils.each(b,function(b,c){var e=g[c];b.translate(a-e.x,(d-(e.y+e.height))/2+f-h[c].bottom),a+=e.width}),this.parentExpression.setOffset(e,f),this.parentExpression.updateBoxSize()}})}},b[37]={value:function(a){var c=b.r(34),d=b.r(20),e={subOffset:0,supOffset:0,zoom:.66};return c.createClass("ScriptController",{constructor:function(a,b,d,f,g){this.observer=a.getParentExpression(),this.target=b,this.sup=d,this.sub=f,this.options=c.Utils.extend({},e,g)},applyUpDown:function(){var a=this.target,b=this.sup,c=this.sub,e=this.options;b.scale(e.zoom),c.scale(e.zoom);var f=a.getFixRenderBox();return d.isEmpty(b)&&d.isEmpty(c)?{width:f.width,height:f.height,top:0,bottom:0}:!d.isEmpty(b)&&d.isEmpty(c)?this.applyUp(a,b):d.isEmpty(b)&&!d.isEmpty(c)?this.applyDown(a,c):this.applyUpDownScript(a,b,c)},applySide:function(){var a=this.target,b=this.sup,c=this.sub;if(d.isEmpty(b)&&d.isEmpty(c)){var e=a.getRenderBox(this.observer);return{width:e.width,height:e.height,top:0,bottom:0}}return d.isEmpty(b)&&!d.isEmpty(c)?this.applySideSub(a,c):!d.isEmpty(b)&&d.isEmpty(c)?this.applySideSuper(a,b):this.applySideScript(a,b,c)},applySideSuper:function(a,b){b.scale(this.options.zoom);var c=a.getRenderBox(this.observer),d=b.getRenderBox(this.observer),e=a.getMeanline(this.observer),f=b.getBaseline(this.observer),g=e,h=f-g,i={top:0,bottom:0,width:c.width+d.width,height:c.height};return b.translate(c.width,0),this.options.supOffset&&b.translate(this.options.supOffset,0),h>0?(a.translate(0,h),i.bottom=h,i.height+=h):b.translate(0,-h),i},applySideSub:function(a,b){b.scale(this.options.zoom);var c=a.getRenderBox(this.observer),d=b.getRenderBox(this.observer),e=b.getOffset(),f=a.getBaseline(this.observer),g=(d.height+e.top+e.bottom)/2,h=c.height-f-g,i={top:0,bottom:0,width:c.width+d.width,height:c.height};return b.translate(c.width,e.top+f-g),this.options.subOffset&&b.translate(this.options.subOffset,0),0>h&&(i.top=-h,i.height-=h),i},applySideScript:function(a,b,c){b.scale(this.options.zoom),c.scale(this.options.zoom);var d=a.getRenderBox(this.observer),e=c.getRenderBox(this.observer),f=b.getRenderBox(this.observer),g=a.getMeanline(this.observer),h=a.getBaseline(this.observer),i=b.getBaseline(this.observer),j=c.getAscenderline(this.observer),k=g,l=g+2*(h-g)/3,m=k-i,n=d.height-l-(e.height-j),o={top:0,bottom:0,width:d.width+Math.max(e.width,f.width),height:d.height};return b.translate(d.width,m),c.translate(d.width,l-j),this.options.supOffset&&b.translate(this.options.supOffset,0),this.options.subOffset&&c.translate(this.options.subOffset,0),m>0?0>n&&(d.height-=n,o.top=-n):(a.translate(0,-m),b.translate(0,-m),c.translate(0,-m),o.height-=m,n>0?o.bottom=-m:(o.height-=n,m=-m,n=-n,m>n?o.bottom=m-n:o.top=n-m)),o},applyUp:function(a,b){var c=b.getFixRenderBox(),d=a.getFixRenderBox(),e={width:Math.max(d.width,c.width),height:c.height+d.height,top:0,bottom:c.height};return b.translate((e.width-c.width)/2,0),a.translate((e.width-d.width)/2,c.height),e},applyDown:function(a,b){var c=b.getFixRenderBox(),d=a.getFixRenderBox(),e={width:Math.max(d.width,c.width),height:c.height+d.height,top:c.height,bottom:0};return b.translate((e.width-c.width)/2,d.height),a.translate((e.width-d.width)/2,0),e},applyUpDownScript:function(a,b,c){var d=b.getFixRenderBox(),e=c.getFixRenderBox(),f=a.getFixRenderBox(),g={width:Math.max(f.width,d.width,e.width),height:d.height+e.height+f.height,top:0,bottom:0};return b.translate((g.width-d.width)/2,0),a.translate((g.width-f.width)/2,d.height),c.translate((g.width-e.width)/2,d.height+f.height),g}})}},b[38]={value:function(a){function c(a,b){return new d.Rect(a+2*b,1).fill("black")}var d=b.r(34),e=b.r(47).zoom;return d.createClass("FractionOperator",{base:b.r(41),constructor:function(){this.callBase("Fraction")},applyOperand:function(a,b){a.scale(e),b.scale(e);var d=Math.ceil(a.getWidth()),f=Math.ceil(b.getWidth()),g=Math.ceil(a.getHeight()),h=Math.ceil(b.getHeight()),i=3,j=1,k=Math.max(d,f),l=Math.max(g,h),m=c(k,i);this.addOperatorShape(m),a.translate((k-d)/2+i,0),m.translate(0,g+1),b.translate((k-f)/2+i,g+m.getHeight()+2),this.parentExpression.setOffset(l-g,l-h),this.parentExpression.expand(2*j,2*j),this.parentExpression.translateElement(j,j)}})}},b[39]={value:function(a){function c(){var a=new e(this.funcName,"KF AMS ROMAN");return this.addOperatorShape(a),a.getBaseline=function(){return a.getFixRenderBox().height},a.getMeanline=function(){return 0},a}var d=b.r(34),e=b.r(5),f=b.r(37);return d.createClass("FunctionOperator",{base:b.r(41),constructor:function(a){this.callBase("Function: "+a),this.funcName=a},applyOperand:function(a,b,d){var e=c.call(this),g=a.getFixRenderBox(),h=this.parentExpression.isSideScript()?"applySide":"applyUpDown",i=new f(this,e,b,d,{zoom:.5})[h](),j=5,k=(i.height+i.top+i.bottom-g.height)/2;e.translate(0,i.top),b.translate(0,i.top),d.translate(0,i.top),k>=0?a.translate(i.width+j,k):(k=-k,e.translate(0,k),b.translate(0,k),d.translate(0,k),a.translate(i.width+j,0)),this.parentExpression.expand(j,2*j),this.parentExpression.translateElement(j,j)}})}},b[40]={value:function(a){var c=b.r(34),d=b.r(37);return c.createClass("IntegrationOperator",{base:b.r(41),constructor:function(a){this.callBase("Integration"),this.opType=a||1},setType:function(a){this.opType=0|a},resetType:function(){this.opType=1},applyOperand:function(a,b,c){var e=this.getOperatorShape(),f=3,g=a.getFixRenderBox(),h=new d(this,e,b,c,{supOffset:3,subOffset:-15}).applySide(),i=(h.height+h.top-g.height)/2;e.translate(0,h.top),b.translate(0,h.top),c.translate(0,h.top),i>=0?a.translate(h.width+f,i):(i=-i,e.translate(0,i),b.translate(0,i),c.translate(0,i),a.translate(h.width+f,0)),this.parentExpression.expand(f,2*f),this.parentExpression.translateElement(f,f)},getOperatorShape:function(){var a="M1.318,48.226c0,0,0.044,0.066,0.134,0.134c0.292,0.313,0.626,0.447,1.006,0.447c0.246,0.022,0.358-0.044,0.604-0.268   c0.782-0.782,1.497-2.838,2.324-6.727c0.514-2.369,0.938-4.693,1.586-8.448C8.559,24.068,9.9,17.878,11.978,9.52   c0.917-3.553,1.922-7.576,3.866-8.983C16.247,0.246,16.739,0,17.274,0c1.564,0,2.503,1.162,2.592,2.57   c0,0.827-0.424,1.386-1.273,1.386c-0.671,0-1.229-0.514-1.229-1.251c0-0.805,0.514-1.095,1.185-1.274   c0.022,0-0.291-0.29-0.425-0.379c-0.201-0.134-0.514-0.224-0.737-0.224c-0.067,0-0.112,0-0.157,0.022   c-0.469,0.134-0.983,0.939-1.453,2.234c-0.537,1.475-0.961,3.174-1.631,6.548c-0.424,2.101-0.693,3.464-1.229,6.727   c-1.608,9.185-2.949,15.487-5.006,23.756c-0.514,2.034-0.849,3.24-1.207,4.335c-0.559,1.698-1.162,2.95-1.811,3.799   c-0.514,0.715-1.385,1.408-2.436,1.408c-1.363,0-2.391-1.185-2.458-2.592c0-0.804,0.447-1.363,1.273-1.363   c0.671,0,1.229,0.514,1.229,1.251C2.503,47.757,1.989,48.047,1.318,48.226z",b=new c.Group,d=new c.Group,e=new c.Path(a).fill("black"),f=new c.Rect(0,0,0,0).fill("transparent"),g=null;d.addShape(e),b.addShape(f),b.addShape(d),this.addOperatorShape(b);for(var h=1;h<this.opType;h++)g=new c.Use(e).translate(e.getWidth()/2*h,0),d.addShape(g);return d.scale(1.6),g=null,b.getBaseline=function(){return d.getFixRenderBox().height},b.getMeanline=function(){return 10},b}})}},b[41]={value:function(a){var c=b.r(34),d=b.r(6);return c.createClass("Operator",{base:b.r(46),constructor:function(a){this.callBase(),this.type=d.OP,this.parentExpression=null,this.operatorName=a,this.operatorShape=new c.Group,this.addShape(this.operatorShape)},applyOperand:function(){throw new Error("applyOperand is abstract")},setParentExpression:function(a){this.parentExpression=a},getParentExpression:function(){return this.parentExpression},clearParentExpression:function(){this.parentExpression=null},addOperatorShape:function(a){return this.operatorShape.addShape(a)},getOperatorShape:function(){return this.operatorShape}})}},b[42]={value:function(a){function c(a,b){var c=d(a),i=e(a),j=5,k=f(a);this.addOperatorShape(c),this.addOperatorShape(i),this.addOperatorShape(k),h.call(this,g(c,i,k),this.operatorShape,a,b),this.parentExpression.expand(0,2*j),this.parentExpression.translateElement(0,j)}function d(a){var b=new i.Path,c=j,d=a.getHeight()/3,e=b.getDrawer();return e.moveTo(0,m*c*6),e.lineBy(l*c,m*c),e.lineBy(m*c*3,-l*c*3),e.lineBy(n*d,d),e.lineBy(l*c*3,-m*c*3),e.lineBy(-l*d,-d),e.close(),b.fill("black")}function e(a){var b=new i.Path,c=.9*a.getHeight(),d=b.getDrawer();return d.moveTo(n*c,0),d.lineTo(0,c),d.lineBy(l*j*3,m*j*3),d.lineBy(n*c+l*j*3,-(c+3*j*m)),d.close(),b.fill("black")}function f(a){var b=a.getWidth()+2*j;return new i.Rect(b,2*j).fill("black")}function g(a,b,c){var d=a.getFixRenderBox(),e=b.getFixRenderBox();return b.translate(d.width-l*j*3,0),a.translate(0,e.height-d.height),e=b.getFixRenderBox(),c.translate(e.x+e.width-j/m,0),{x:e.x+e.width-j/m,y:0}}function h(a,b,c,d){var e=null,f={x:0,y:0},g=b.getFixRenderBox();d.scale(.66),e=d.getFixRenderBox(),e.width>0&&e.height>0&&(f.y=e.height-g.height/2,f.y<0&&(d.translate(0,-f.y),f.y=0),f.x=e.width+g.height/2*n-a.x),b.translate(f.x,f.y),c.translate(f.x+a.x+j,f.y+2*j)}var i=b.r(34),j=1,k=2*Math.PI/360,l=Math.sin(15*k),m=Math.cos(15*k),n=Math.tan(15*k);return i.createClass("RadicalOperator",{base:b.r(41),constructor:function(){this.callBase("Radical")},applyOperand:function(a,b){c.call(this,a,b)}})}},b[43]={value:function(a){var c=b.r(34),d=b.r(37);return c.createClass("ScriptOperator",{base:b.r(41),constructor:function(a){this.callBase(a||"Script")},applyOperand:function(a,b,c){var e=1,f=this.parentExpression,g=new d(this,a,b,c).applySide();this.getOperatorShape(),g&&f.setOffset(g.top,g.bottom),f.expand(4,2*e),f.translateElement(2,e)}})}},b[44]={value:function(a){var c=b.r(34),d=b.r(37);return c.createClass("SummationOperator",{base:b.r(41),constructor:function(){this.callBase("Summation"),this.displayType="equation"},applyOperand:function(a,b,c){var e=this.getOperatorShape(),f=a.getFixRenderBox(),g=0,h=new d(this,e,b,c).applyUpDown(),i=(h.height-h.top-h.bottom-f.height)/2;i>=0?a.translate(h.width+g,i+h.bottom):(i=-i,e.translate(0,i),b.translate(0,i),c.translate(0,i),a.translate(h.width+g,h.bottom)),this.parentExpression.setOffset(h.top,h.bottom),this.parentExpression.expand(g,2*g),this.parentExpression.translateElement(g,g)},getOperatorShape:function(){var a="M0.672,33.603c-0.432,0-0.648,0-0.648-0.264c0-0.024,0-0.144,0.24-0.432l12.433-14.569L0,0.96c0-0.264,0-0.72,0.024-0.792   C0.096,0.024,0.12,0,0.672,0h28.371l2.904,6.745h-0.6C30.531,4.8,28.898,3.72,28.298,3.336c-1.896-1.2-3.984-1.608-5.28-1.8   c-0.216-0.048-2.4-0.384-5.617-0.384H4.248l11.185,15.289c0.168,0.24,0.168,0.312,0.168,0.36c0,0.12-0.048,0.192-0.216,0.384   L3.168,31.515h14.474c4.608,0,6.96-0.624,7.464-0.744c2.76-0.72,5.305-2.352,6.241-4.848h0.6l-2.904,7.681H0.672z",b=new c.Path(a).fill("black"),d=new c.Rect(0,0,0,0).fill("transparent"),e=new c.Group,f=null;return e.addShape(d),e.addShape(b),b.scale(1.6),this.addOperatorShape(e),f=b.getFixRenderBox(),"inline"===this.displayType?(b.translate(5,15),d.setSize(f.width+10,f.height+25)):(b.translate(2,5),d.setSize(f.width+4,f.height+8)),e}})}},b[45]={value:function(a){function c(a){a=f.Utils.extend({},h,a),/^(https?:)?\/\//.test(a.path)||(a.path=e(a.path)),new i(document,a.path).mount(d)}function d(){f.Utils.each(g,function(a){a(j)})}function e(a){var b,c=location.pathname.split("/");return c.length-=1,c=c.join("/")+"/",b=[location.protocol,"//",location.host,c,a.replace(/^\//,"")],b.join("")}var f=b.r(34),g=[],h=b.r(47).resource,i=b.r(24),j=b.r(31),k=!1,l=!1;return{ready:function(a,b){l||(l=!0,c(b)),k?window.setTimeout(function(){a(j)},0):g.push(a)}}}},b[46]={value:function(a){var c=b.r(34),d=b.r(6);return c.createClass("SignGroup",{base:c.Group,constructor:function(){this.callBase(),this.box=new c.Rect(0,0,0,0),this.type=d.UNKNOWN,this.addShape(this.box),this.zoom=1},setZoom:function(a){this.zoom=a},getZoom:function(){return this.zoom},setBoxSize:function(a,b){return this.box.setSize(a,b)},setBoxWidth:function(a){return this.box.setWidth(a)},setBoxHeight:function(a){return this.box.setHeight(a)},getType:function(){return this.type},getBaseHeight:function(){return this.getHeight()},getBaseWidth:function(){return this.getWidth()},addedCall:function(){}})}},b[47]={value:function(a){return{zoom:.66,font:{meanline:Math.round(19),baseline:Math.round(40),baseHeight:50,list:[b.r(29),b.r(27),b.r(28),b.r(26),b.r(30)]},resource:{path:"src/resource/"},func:{"ud-script":{lim:!0}}}}},b[48]={value:function(a){window.kf={ResourceManager:b.r(45),Operator:b.r(41),Expression:b.r(21),CompoundExpression:b.r(19),TextExpression:b.r(22),EmptyExpression:b.r(20),CombinationExpression:b.r(12),FunctionExpression:b.r(14),FractionExpression:b.r(13),IntegrationExpression:b.r(15),RadicalExpression:b.r(16),ScriptExpression:b.r(17),SuperscriptExpression:b.r(9),SubscriptExpression:b.r(8),SummationExpression:b.r(18),BracketsExpression:b.r(11)}}};var c={"kf.start":48};!function(b){kity.Shape.getRenderBox;kity.extendClass(kity.Shape,{getFixRenderBox:function(){return this.getRenderBox(this.container.container)},getTranslate:function(){return this.transform.translate}});try{a("kf.start")}catch(c){}}(this)}();